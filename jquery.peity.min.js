(function(n,z,x){var A=z.createElement("canvas").getContext,r=n.fn.peity=function(a,b){A&&this.each(function(){var e=n(this),d=e.data("peity");if(d)a&&(d.type=a),n.extend(d.opts,b),d.draw();else{var f=r.defaults[a],c={};n.each(e.data(),function(a,b){a in f&&(c[a]=b)});var l=n.extend({},f,c,b),d=new y(e,a,l);d.draw();e.change(function(a,b,c){d.draw()}).data("peity",d)}});return this},y=function(a,b,e){this.$el=a;this.type=b;this.opts=e},v=y.prototype;v.colours=function(){var a=this.opts.colours;return n.isFunction(a)?
a:function(b,e){return a[e%a.length]}};v.draw=function(){r.graphers[this.type].call(this,this.opts)};v.prepareCanvas=function(a,b){var e=this.canvas,d;e?(this.context.clearRect(0,0,e.width,e.height),d=n(e)):(d=n("<canvas>").css({height:b,width:a}).addClass("peity").data("peity",this),this.canvas=e=d[0],this.context=e.getContext("2d"),this.$el.hide().after(e));e.height=d.height()*x;e.width=d.width()*x;return e};v.hoverEvent=function(a){this.removeEventListener("mouseout",this.exitEvent,!1);this.removeEventListener("mousemove",
this.hoverEvent,!1);var b=this.getBoundingClientRect();a={x:a.clientX-b.left,y:a.clientY-b.top};n(this.previousSibling).data("position",JSON.stringify(a)).change()};v.exitEvent=function(a){this.removeEventListener("mouseout",this.exitEvent,!1);this.removeEventListener("mousemove",this.hoverEvent,!1);n(this.previousSibling).removeData("position").change()};v.values=function(){return this.$el.text().split(this.opts.delimiter).map(function(a){return parseFloat(a)})};r.defaults={};r.graphers={};r.register=
function(a,b,e){this.defaults[a]=b;this.graphers[a]=e};r.register("pie",{colours:["#ff9900","#fff4dd","#ffc66e"],delimiter:null,diameter:16,strokeColour:"#000000",strokeWidth:0,fontColour:"#000000",fontStyle:"12pt Arial, sans-serif",focusWidth:0,focusColour:"#000"},function(a){if(!a.delimiter){var b=this.$el.text().match(/[^0-9\.]/);a.delimiter=b?b[0]:","}b=this.values();if("/"==a.delimiter)var e=b[0],b=[e,b[1]-e];var d,f=0,e=b.length;for(d=0;d<e;d++)f+=b[d];var c=this.$el.data("position"),l=a.focusWidth,
t=a.strokeWidth,h=Math.max(l,t)+1,m=this.prepareCanvas((a.width||a.diameter)+h,(a.height||a.diameter)+h),g=this.context;d=m.width;var k=m.height,h=Math.min(d,k)/2-h,u=2*Math.PI,f=u/f,s=this.colours();if(0<l&&void 0!==c){c=JSON.parse(c);c.x-=d/2;c.y-=k/2;c.y*=-1;c.r=Math.sqrt(c.x*c.x+c.y*c.y);for(c.theta=Math.atan2(c.y,c.x);0>c.theta;)c.theta+=u;for(;c.theta>u;)c.theta-=u}g.translate(d/2,k/2);var p,q=0;for(d=0;d<e;d++)k=b[d],p=k*f,g.beginPath(),g.moveTo(0,0),g.arc(0,0,h,-q,-(q+p),!0),g.fillStyle=s.call(this,
k,d,b),g.fill(),0<l&&c&&c.theta>q&&c.theta<q+p&&(g.beginPath(),g.arc(0,0,h+l/2,-q,-(q+p),!0),g.strokeStyle=a.focusColour,g.lineWidth=l,g.stroke()),q+=p;0<t&&(g.beginPath(),g.arc(0,0,h+t/2,0,u,!0),g.strokeStyle=a.strokeColour,g.lineWidth=t,g.stroke());0<l&&(m.addEventListener("mousemove",v.hoverEvent,!1),m.addEventListener("mouseout",v.exitEvent,!1))});r.register("line",{colour:"#c6d9fd",strokeColour:"#4d89f9",strokeWidth:1,delimiter:",",height:16,max:null,min:0,width:32},function(a){var b=this.values();
1==b.length&&b.push(b[0]);var e=Math.max.apply(Math,b.concat([a.max])),d=Math.min.apply(Math,b.concat([a.min])),f=this.prepareCanvas(a.width,a.height),c=this.context,l=f.width,f=f.height,t=l/(b.length-1),e=f/(e-d),h=[],m;c.beginPath();c.moveTo(0,f+d*e);for(m=0;m<b.length;m++){var g=m*t,k=f-e*(b[m]-d);h.push({x:g,y:k});c.lineTo(g,k)}c.lineTo(l,f+d*e);c.fillStyle=a.colour;c.fill();if(a.strokeWidth){c.beginPath();c.moveTo(0,h[0].y);for(m=0;m<h.length;m++)c.lineTo(h[m].x,h[m].y);c.lineWidth=a.strokeWidth*
x;c.strokeStyle=a.strokeColour;c.stroke()}});r.register("bar",{baselineHeight:1,baselineColour:"#000000",fontColour:"#000000",fontStyle:"12pt Arial, sans-serif",focusWidth:0,focusColour:"#000",colours:["#4D89F9"],delimiter:",",height:16,max:null,min:0,spacing:1,width:32},function(a){var b,e,d,f,c,l,t,h=this.values(),m=Math.max.apply(Math,h.concat([a.max])),g=Math.min.apply(Math,h.concat([a.min])),k=this.$el.data("position"),u=this.prepareCanvas(a.width,a.height),s=this.context,p=a.spacing;t=this.colours();
var q=a.focusWidth;b=u.width-2*p;var n=u.height-2*p;a.baselineHeight&&(n-=1);var r=n/(m-g),w=(b+p)/h.length;s.fillStyle=a.baselineColour;s.fillRect(0,r*m+p-a.baselineHeight/2,u.width,a.baselineHeight);for(b=0;b<h.length;b++){e=p+b*w;c=w-p;l=h[b];d=p+n-r*(l-g);if(0==l){if(0<=g||0<m)d-=1;f=1}else f=r*h[b];s.fillStyle=t.call(this,l,b,h);s.fillRect(e,d,c,f)}if(0<q&&k)for(k=JSON.parse(k),b=0;b<h.length;b++)if(e=p+b*w,c=w-p,k.x>=e&&k.x<=e+c){l=h[b];d=p+n-r*(l-g);if(0==l){if(0<=g||0<m)d-=1;f=1}else f=r*
h[b];t=d+(0>f?f:0);f=0>f?-f:f;k.y>=t&&k.y<=t+f&&(s.strokeStyle=a.focusColour,s.lineWidth=q,s.strokeRect(e-q/2,t-q/2,c+q,f+q),s.fillStyle=a.fontColour,s.font=a.fontStyle,k.x>u.width/2&&(s.textAlign="right"),k.y<u.height/2&&(s.textBaseline="top",k.y+=20),s.fillText(l+"",k.x,k.y))}0<q&&(u.addEventListener("mousemove",v.hoverEvent,!1),u.addEventListener("mouseout",v.exitEvent,!1))})})(jQuery,document,window.devicePixelRatio||1);
