// Peity jQuery plugin version 1.2.1
// (c) 2013 Ben Pickles
//
// http://benpickles.github.io/peity
//
// Released under MIT license.
(function(u,p){var z=document.createElement("canvas").getContext,s=u.fn.peity=function(a,c){z&&this.each(function(){var b=u(this),f=b.data("peity");if(f)a&&(f.type=a),u.extend(f.opt,c),f.draw();else{var k=s.defaults[a],d={};u.each(b.data(),function(a,b){a in k&&(d[a]=b)});var e=u.extend({},k,d,c),f=new y(b,a,e);f.draw();b.change(function(a,b,c){f.draw()}).data("peity",f)}});return this},y=function(a,c,b){this.$el=a;this.type=c;this.opt=b},r=y.prototype;r.fill=function(){var a=this.opt.fill;return u.isFunction(a)?
a:function(c,b){return a[b%a.length]}};r.draw=function(){s.graphers[this.type].call(this,this.opt)};r.prepareCanvas=function(a,c){var b=this.canvas,f;b?b.width=b.width:(f=u("<canvas>").css({height:c,width:a}).addClass("peity").data("peity",this),this.canvas=b=f[0],this.context=b.getContext("2d"),this.$el.hide().after(b),b.height=f.height(),b.width=f.width());return b};r.hoverEvent=function(a){r.removeEvents(this);var c=this.getBoundingClientRect();u(this).prev().data("mouse",JSON.stringify({x:a.clientX-
c.left,y:a.clientY-c.top})).change()};r.exitEvent=function(a){r.removeEvents(this);u(this).prev().removeData("mouse").change()};r.removeEvents=function(a){a.removeEventListener("mouseout",a.exitEvent,!1);a.removeEventListener("mousemove",a.hoverEvent,!1)};r.addEvents=function(a){a.addEventListener("mousemove",r.hoverEvent,!1);a.addEventListener("mouseout",r.exitEvent,!1)};r.values=function(){var a=this.opt.delimiter,c=this.opt.seriesDelimiter,b=this.$el.text(),f=function(b){return b.split(a).map(function(a){return parseFloat(a)})};
return c?b.split(c).map(f):f(b)};r.drawArc=function(a,c,b,f,k,d){a.beginPath();a.arc(0,0,c,b,f,!0);a.strokeStyle=k;a.lineWidth=d;a.stroke()};s.defaults={};s.graphers={};s.register=function(a,c,b){this.defaults[a]=c;this.graphers[a]=b};s.register("pie",{fill:["#f90","#ffd","#fc6"],delimiter:null,diameter:16,lineColor:"#000",lineWidth:0,focusColor:"#000",focusWidth:0},function(a){if(!a.delimiter){var c=this.$el.text().match(/[^0-9\.]/);a.delimiter=c?c[0]:","}c=this.values();"/"===a.delimiter&&(c=[c[0],
c[1]-c[0]]);var b,f=0,k=c.length;for(b=0;b<k;b++)f+=c[b];var d=this.$el.data("mouse"),e=a.focusWidth,m=a.lineWidth,q=p.max(e,m)+1,g=a.diameter,g=this.prepareCanvas(g+q,g+q),l=this.context;b=g.width;var h=g.height,q=b/2-q,n=2*p.PI,f=n/f,r=this.fill();if(e&&d){d=JSON.parse(d);d.x-=b/2;d.y-=h/2;d.y*=-1;d.r=p.sqrt(d.x*d.x+d.y*d.y);for(d.a=p.atan2(d.y,d.x);0>d.a;)d.a+=n;for(;d.a>n;)d.a-=n}l.translate(b/2,h/2);var t,v=0;for(b=0;b<k;b++)h=c[b],t=h*f,l.beginPath(),l.moveTo(0,0),l.arc(0,0,q,-v,-(v+t),!0),
l.fillStyle=r.call(this,h,b,c),l.fill(),e&&d&&d.a>v&&d.a<v+t&&this.drawArc(l,q+e/2,-v,-(v+t),a.focusColor,e),v+=t;m&&this.drawArc(l,q+m/2,0,n,a.lineColor,m);e&&this.addEvents(g)});s.register("line",{fill:"#cdf",lineColor:"#48f",lineWidth:1,delimiter:",",height:16,width:32,max:null,min:0},function(a){var c=this.values();1==c.length&&c.push(c[0]);var b=p.max.apply(p,c.concat([a.max])),f=p.min.apply(p,c.concat([a.min])),k=a.lineWidth,d=this.prepareCanvas(a.width,a.height),e=this.context,m=d.width,d=
d.height-k,q=m/(c.length-1),b=d/(b-f),g=[],l;e.beginPath();e.moveTo(0,d+f*b);for(l=0;l<c.length;l++){var h=l*q,n=d-b*(c[l]-f)+k/2;g.push({x:h,y:n});e.lineTo(h,n)}e.lineTo(m,d+f*b);a.fill&&(e.fillStyle=a.fill,e.fill());if(k){e.beginPath();e.moveTo(0,g[0].y);for(l=0;l<g.length;l++)e.lineTo(g[l].x,g[l].y);e.lineWidth=k;e.strokeStyle=a.lineColor;e.stroke()}});s.register("lines",{lineColors:["#000000","#666666","#803E75"],lineWidths:[1,2,2],delimiter:",",seriesDelimiter:"|",height:16,max:null,min:0,width:32},
function(a){var c=this.values(),b=[].concat.apply([a.max,a.min],c),f=p.max.apply(p,b),b=p.min.apply(p,b),k=this.prepareCanvas(a.width,a.height),d=this.context,e=k.width,k=k.height,m=e/(c[0].length-1),f=k/(f-b),q=a.lineColors;a=a.lineWidths;var g,l,h;h=[{x:0,y:k-f*(0-b)},{x:e,y:k-f*(0-b)}];d.beginPath();d.moveTo(0,h[0].y);for(e=0;e<h.length;e++)d.lineTo(h[e].x,h[e].y);d.lineWidth=a[0%a.length];d.strokeStyle=q[0%q.length];d.stroke();for(g=0;g<c.length;g+=1){l=c[g];h=[];for(e=0;e<l.length;e++)h.push({x:e*
m,y:k-f*(l[e]-b)});d.beginPath();d.moveTo(0,h[0].y);for(e=0;e<h.length;e++)d.lineTo(h[e].x,h[e].y);d.lineWidth=a[(g+1)%a.length];d.strokeStyle=q[(g+1)%q.length];d.stroke()}});s.register("bar",{fill:["#48f"],axisColor:"#000",axisSize:1,fontColor:"#000",font:"12pt sans-serif",focusColor:"#000",focusWidth:0,height:16,width:32,max:null,min:0,delimiter:",",gap:1},function(a){var c,b,f,k,d,e,m=this.values();b=p.max.apply(p,m.concat([a.max]));var q=p.min.apply(p,m.concat([a.min])),g=this.$el.data("mouse"),
l=this.prepareCanvas(a.width,a.height),h=this.context,n=a.gap,r=this.fill(),t=a.focusWidth;c=a.axisSize;var v=l.width,u=l.height,s=u-2*n-c,w=s/(b-q),x=(v-2*n+n)/m.length;b=w*b+n;c&&(h.fillStyle=a.axisColor,h.fillRect(0,b-c/2,v,c));for(c=0;c<m.length;c++)e=m[c],b=n+c*x,d=x-n,f=n+s-w*(e-q),k=w*e,h.fillStyle=r.call(this,e,c,m),h.fillRect(b,f,d,k);if(t&&g)for(g=JSON.parse(g),c=0;c<m.length;c++)if(b=n+c*x,d=x-n,g.x>=b&&g.x<=b+d){e=m[c];f=n+s-w*(e-q);k=0===e?1:w*m[c];f+=p.min(k,0);k=p.abs(k);g.y>=f&&g.y<=
f+k&&(h.strokeStyle=a.focusColor,h.lineWidth=t,h.strokeRect(b-t/2,f-t/2,d+t,k+t),h.fillStyle=a.fontColor,h.font=a.font,g.x>v/2&&(h.textAlign="right"),g.y<u/2&&(h.textBaseline="top",g.y+=20),h.fillText(e+"",g.x,g.y));break}t&&this.addEvents(l)})})(jQuery,Math);
