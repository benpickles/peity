// Peity jQuery plugin version 1.2.1
// (c) 2013 Ben Pickles
//
// http://benpickles.github.io/peity
//
// Released under MIT license.
(function(t,m){var H=document.createElement("canvas").getContext,A=t.fn.peity=function(a,b){H&&this.each(function(){var c=t(this),e=c.data("peity");if(e)a&&(e.type=a),t.extend(!0,e.opt,b),e.draw();else{var p=A.defaults[a],d={};t.each(c.data(),function(a,b){a in p&&(d[a]=b)});var n=t.extend(!0,{},p,d,b),e=new F(c,a,n);e.draw();c.change(function(a,b,d){e.draw()}).data("peity",e)}});return this},F=function(a,b,c){this.$el=a;this.type=b;this.opt=c},f=F.prototype;f.fill=function(){var a=this.opt.fill;
return t.isFunction(a)?a:function(b,c){return a[c%a.length]}};f.draw=function(){A.graphers[this.type].call(this,this.opt)};f.prepareCanvas=function(a,b){var c=this.canvas,e;c?c.width=c.width:(e=t("<canvas>").css({height:b,width:a}).addClass("peity").data("peity",this),this.canvas=c=e[0],this.context=c.getContext("2d"),this.$el.hide().after(c),c.height=e.height(),c.width=e.width());return c};f.hoverEvent=function(a){f.removeEvents(this);var b=this.getBoundingClientRect();t(this).prev().data("mouse",
JSON.stringify({x:a.clientX-b.left,y:a.clientY-b.top})).change()};f.exitEvent=function(a){f.removeEvents(this);t(this).prev().removeData("mouse").change()};f.removeEvents=function(a){a.removeEventListener("mouseout",a.exitEvent,!1);a.removeEventListener("mousemove",a.hoverEvent,!1)};f.addEvents=function(a){a.addEventListener("mousemove",f.hoverEvent,!1);a.addEventListener("mouseout",f.exitEvent,!1)};f.values=function(){var a=this.opt.delimiter,b=this.opt.seriesDelimiter,c=this.$el.text(),e=function(b){return b.split(a).map(function(a){return parseFloat(a)})};
return b?c.split(b).map(e):e(c)};f.setLineStyle=function(a,b,c){a.lineWidth=c;a.strokeStyle=b};f.drawArc=function(a,b,c,e,p,d,n,m){a.beginPath();a.arc(b,c,e,p,d,!0);f.setLineStyle(a,n,m);a.stroke()};f.drawCircle=function(a,b,c,e,p,d,n){a.beginPath();a.moveTo(b,c);a.arc(b,c,e,p,d,!0);a.fillStyle=n;a.fill()};f.drawLine=function(a,b,c,e){a.beginPath();a.moveTo(b[0].x,b[0].y);for(var p=1;p<b.length;p++)a.lineTo(b[p].x,b[p].y);this.setLineStyle(a,c,e);a.stroke()};f.drawGrid=function(a,b,c,e,p,d,n,m,g,
q,h,f,r,u,s,k){var l=function(){return h-f*(v-r)+k},v=0;b&&(a.beginPath(),a.moveTo(g,l()),a.lineTo(q,l()),this.setLineStyle(a,e,b),a.stroke());if(c)for(this.setLineStyle(a,p,c),v=r;v<=u;v+=s)a.beginPath(),a.moveTo(g,l()),a.lineTo(q,l()),a.stroke(),3<g&&(a.fillStyle=d,a.font=n+"px sans-serif",a.textAlign="right",a.textBaseline=l()>n/2?l()>h-n/2?"bottom":"middle":"top",a.fillText(m(v)+"",g-1,l()))};A.defaults={};A.graphers={};A.register=function(a,b,c){this.defaults[a]=b;this.graphers[a]=c};A.register("pie",
{fill:["#f90","#ffd","#fc6"],lineColor:"#000",lineWidth:0,focusColor:"#000",focusWidth:0,delimiter:null,diameter:16},function(a){if(!a.delimiter){var b=this.$el.text().match(/[^0-9\.]/);a.delimiter=b?b[0]:","}b=this.values();"/"===a.delimiter&&(b=[b[0],b[1]-b[0]]);var c,e=0,p=b.length;for(c=0;c<p;c++)e+=b[c];var d=this.$el.data("mouse"),n=a.focusWidth,f=a.lineWidth,g=m.max(n,f)+1,q=a.diameter,q=this.prepareCanvas(q+g,q+g),h=this.context;c=q.width;var y=q.height,g=c/2-g,r=2*m.PI,e=r/e,u=this.fill();
if(n&&d){d=JSON.parse(d);d.x-=c/2;d.y-=y/2;d.y*=-1;d.r=m.sqrt(d.x*d.x+d.y*d.y);for(d.a=m.atan2(d.y,d.x);0>d.a;)d.a+=r;for(;d.a>r;)d.a-=r}h.translate(c/2,y/2);var s,k=0;for(c=0;c<p;c++)y=b[c],s=y*e,this.drawCircle(h,0,0,g,-k,-(k+s),u.call(this,y,c,b)),n&&d&&d.a>k&&d.a<k+s&&this.drawArc(h,0,0,g+n/2,-k,-(k+s),a.focusColor,n),k+=s;f&&this.drawArc(h,0,0,g+f/2,0,r,a.lineColor,f);n&&this.addEvents(q)});A.register("line",{fill:"#cdf",lineColor:"#48f",lineWidth:1,delimiter:",",height:150,width:400,left:0,
max:null,min:0,pointSize:3,focus:!1,xAxis:{color:"#000",size:13,formatter:function(a){return a}},yAxis:{color:"#000",size:13,formatter:function(a){return a}},focus:{color:"#000",width:0},tooltip:{color:"#000",size:13,formatter:function(a){return a}},gridlines:{widths:[1,1],colors:["#000","#bbb"]}},function(a){var b=this.$el.data("mouse"),c=this.values();1==c.length&&c.push(c[0]);var e=a.labels;e&&(e=e.map(function(a){return a+""}));var p=0;e&&(p=m.max.apply(this,e.map(function(a){return a.replace(/[^ ]/g,
"").length}))+1);var d=m.max.apply(m,c.concat([a.max])),n=m.min.apply(m,c.concat([a.min])),f=a.region||(d-n)/5,g=a.lineWidth,q=a.pointSize,h=a.focus,y=a.xAxis,r=a.yAxis,u=a.tooltip,s=a.gridlines,k=this.prepareCanvas(a.width,a.height),l=this.context,v=a.left+q,E=k.width,z=k.height-g-(p*y.size+4),B=(E-q-v)/(c.length-1),C=z/(d-n),D=z+n*C,w=[],x;l.beginPath();l.moveTo(v,D);for(x=0;x<c.length;x++){var G=x*B+v,t=D-C*c[x]+g/2;w.push({x:G,y:t});l.lineTo(G,t)}l.lineTo(E-q/2,D);a.fill&&(l.fillStyle=a.fill,
l.fill());this.drawGrid(l,s.widths[0],s.widths[1],s.colors[0],s.colors[1],r.color,r.size,r.formatter,v,E,z,C,n,d,f,0);g&&this.drawLine(l,w,a.lineColor,g);if(a.pointSize)for(x=0;x<w.length;x++)this.drawCircle(l,w[x].x,w[x].y,a.pointSize,0,2*m.PI,a.lineColor);p&&(l.fillStyle=y.color,l.font=y.size+"px sans-serif",l.textBaseline="top",l.textAlign="center",w.forEach(function(a,b){e[b].split(" ").forEach(function(b,c){l.fillText(b,a.x,z+1+c*y.size)})}));if(h&&b)for(b=JSON.parse(b),x=0;x<w.length;x++)if(a=
w[x],b.x>=a.x-B/3&&b.x<=a.x+B/3){l.fillStyle=u.color;l.font=u.size+"px sans-serif";b.x>E/2&&(l.textAlign="right");b.y<z/2&&(l.textBaseline="top",b.y+=20);l.fillText(u.formatter(c[x])+"",b.x,b.y);break}h&&this.addEvents(k)});A.register("lines",{lineColors:["#666666","#803E75"],lineWidths:[1],delimiter:",",seriesDelimiter:"|",height:16,width:32,left:0,max:null,min:0,pointSizes:[2],xAxis:{color:"#000",size:13,formatter:function(a){return a}},yAxis:{color:"#000",size:13,formatter:function(a){return a}},
focus:!1,tooltip:{color:"#000",size:13,formatter:function(a){return a}},gridlines:{widths:[1,1],colors:["#000","#bbb"]}},function(a){var b=this.$el.data("mouse"),c=this.values(),e=a.pointSizes,p=a.xAxis,d=a.yAxis,n=a.focus,f=a.tooltip,g=a.gridlines,q=[].concat.apply([a.max,a.min],c),h=a.labels;h&&(h=h.map(function(a){return a+""}));var y=0;h&&(y=m.max.apply(this,h.map(function(a){return a.replace(/[^ ]/g,"").length}))+1);var r=m.max.apply(m,q),u=m.min.apply(m,q),s=a.region||(r-u)/5,q=this.prepareCanvas(a.width,
a.height),k=this.context,l=a.left,v=y*p.size+4,t=q.width,z=t-2*m.max.apply(m,e)-l,B=q.height-v,v=z/(c[0].length-0.5),z=B/(r-u),C=a.lineColors,D=a.lineWidths,g=a.gridlines,w,x;this.drawGrid(k,g.widths[0],g.widths[1],g.colors[0],g.colors[1],d.color,d.size,d.formatter,l,t,B,z,u,r,s,0);for(d=0;d<c.length;d+=1){r=c[d];s=[];for(w=0;w<r.length;w++)a=r[w],s.push({x:w*v+e[d%e.length]+l+v/4,y:B-z*(a-u)}),this.drawCircle(k,s[w].x,s[w].y,e[d%e.length],0,2*m.PI,C[d%C.length]);this.drawLine(k,s,C[d%C.length],D[d%
D.length]);0===d&&(x=s.slice(0))}y&&(k.fillStyle=p.color,k.font=p.size+"px sans-serif",k.textBaseline="top",k.textAlign="center",x.forEach(function(a,b){h[b].split(" ").forEach(function(b,c){k.fillText(b,a.x,B+1+c*p.size)})}));if(n&&b)for(b=JSON.parse(b),w=0;w<x.length;w++)if(e=x[w],b.x>=e.x-v/3&&b.x<=e.x+v/3){k.font=f.size+"px sans-serif";k.textAlign="right";b.y<B/2?(k.textBaseline="top",b.y+=f.size):(k.textBaseline="bottom",b.y-=f.size);c.forEach(function(a,c){k.fillStyle=C[c%C.length];k.fillText((f.formatter(a[w])||
" ")+" \u25a0",b.x,b.y+c*f.size)});break}n&&this.addEvents(q)});A.register("bar",{fill:["#48f"],delimiter:",",height:40,width:100,left:0,gap:1,xAxis:{color:"#000",size:13,formatter:function(a){return a}},yAxis:{color:"#000",size:13,formatter:function(a){return a}},focus:{color:"#000",width:0},tooltip:{color:"#000",size:13,formatter:function(a){return a}},gridlines:{widths:[1,1],colors:["#000","#bbb"]},max:null,min:0},function(a){var b,c,e=this.values(),f=a.labels;f&&(f=f.map(function(a){return a+
""}));var d=0;f&&(d=m.max.apply(this,f.map(function(a){return a.replace(/[^ ]/g,"").length}))+1);b=m.max.apply(m,e.concat([a.max]));var n=m.min.apply(m,e.concat([a.min])),t=a.region||(b-n)/5,g=this.$el.data("mouse"),q=this.prepareCanvas(a.width,a.height),h=this.context,y=this.fill();c=a.yAxis;var r=a.xAxis,u=a.focus,s=a.tooltip,k=a.gridlines,l=q.width,v=q.height,A=a.gap;a=a.left;var z=v-(d*r.size+4)-k.widths[0],B=z/(b-n),C=(l-2*A-a+A)/e.length;this.drawGrid(h,k.widths[0],k.widths[1],k.colors[0],k.colors[1],
c.color,c.size,c.formatter,a,l,z,B,n,b,t,0);t=[];for(b=0;b<e.length;b++)c=e[b],t.push([a+b*C+A,z-B*(c-n),C-A,0===c?1:B*c]),h.fillStyle=y.call(this,c,b,e),h.fillRect.apply(h,t[b]);d&&(h.fillStyle=r.color,h.font=r.size+"px sans-serif",h.textBaseline="top",h.textAlign="center",t.forEach(function(a,b){f[b].split(" ").forEach(function(b,c){h.fillText(b,a[0]+a[2]/2,z+1+c*r.size)})}));if(u.width&&g)for(g=JSON.parse(g),b=0;b<t.length;b++)if(d=t[b],g.x>=d[0]&&g.x<=d[0]+d[2]){d[1]+=m.min(d[3],0);d[3]=m.abs(d[3]);
g.y>=d[1]&&g.y<=d[1]+d[3]&&(this.setLineStyle(h,u.color,u.width),h.strokeRect(d[0]-u.width/2,d[1]-u.width/2,d[2]+u.width,d[3]+u.width),h.fillStyle=s.color,h.font=s.size+"px sans-serif",g.x>l/2&&(h.textAlign="right"),g.y<v/2?(h.textBaseline="top",g.y+=20):h.textBaseline="bottom",h.fillText(s.formatter(e[b])+"",g.x,g.y));break}u.width&&this.addEvents(q)})})(jQuery,Math);
