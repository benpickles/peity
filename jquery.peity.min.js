// Peity jQuery plugin version 1.2.0
// (c) 2013 Ben Pickles
//
// http://benpickles.github.io/peity
//
// Released under MIT license.
(function(e,t,n){var r=t.createElement("canvas").getContext;var i=e.fn.peity=function(t,n){if(r){this.each(function(){var r=e(this);var o=r.data("peity");if(o){if(t)o.type=t;e.extend(o.opts,n);o.draw()}else{var u=i.defaults[t];var a={};e.each(r.data(),function(e,t){if(e in u)a[e]=t});var f=e.extend({},u,a,n);var o=new s(r,t,f);o.draw();r.change(function(e,t,n){o.draw()}).data("peity",o)}})}return this};var s=function(e,t,n){this.$el=e;this.type=t;this.opts=n};var o=s.prototype;o.colours=function(){var t=this.opts.colours;if(e.isFunction(t))return t;else return function(e,n){return t[n%t.length]}};o.draw=function(){i.graphers[this.type].call(this,this.opts)};o.prepareCanvas=function(t,r){var i=this.canvas;var s;if(i){this.context.clearRect(0,0,i.width,i.height);s=e(i)}else{s=e("<canvas>").css({height:r,width:t}).addClass("peity").data("peity",this);this.canvas=i=s[0];this.context=i.getContext("2d");this.$el.hide().after(i)}i.height=s.height()*n;i.width=s.width()*n;return i};o.values=function(){return this.$el.text().split(this.opts.delimiter).map(function(e){return parseFloat(e)})};i.defaults={};i.graphers={};i.register=function(e,t,n){this.defaults[e]=t;this.graphers[e]=n};i.register("pie",{colours:["#ff9900","#fff4dd","#ffc66e"],delimiter:null,diameter:16,strokeColour:"#000000",strokeWidth:0,fontColour:"#000000",fontStyle:"12pt Arial, sans-serif",focusWidth:0,focusColour:"#000"},function(e){if(!e.delimiter){var t=this.$el.text().match(/[^0-9\.]/);e.delimiter=t?t[0]:","}var n=this.values();if(e.delimiter=="/"){var r=n[0];var i=n[1];n=[r,i-r]}var s,o=0,u=n.length;for(s=0;s<u;s++){o+=n[s]}var a=this.prepareCanvas((e.width||e.diameter)+1,(e.height||e.diameter)+1);var f=this.context;var l=a.width;var c=a.height;var h=Math.min(l,c)/2-e.strokeWidth;var p=Math.PI;var d=2*p;var v=d/o;var m=this.colours();f.save();f.translate(l/2,c/2);f.rotate(-p/2);var g,y;for(s=0;s<u;s++){g=n[s];y=g*v;f.beginPath();f.moveTo(0,0);f.arc(0,0,h,0,y,false);f.fillStyle=m.call(this,g,s,n);f.fill();f.rotate(y)}f.restore();f.translate(l/2,c/2);f.beginPath();f.arc(0,0,h+e.strokeWidth/2,0,d,false);f.strokeStyle=e.strokeColour;f.lineWidth=e.strokeWidth;if(e.strokeWidth>0)f.stroke()});i.register("line",{colour:"#c6d9fd",strokeColour:"#4d89f9",strokeWidth:1,delimiter:",",height:16,max:null,min:0,width:32},function(e){var t=this.values();if(t.length==1)t.push(t[0]);var r=Math.max.apply(Math,t.concat([e.max]));var i=Math.min.apply(Math,t.concat([e.min]));var s=this.prepareCanvas(e.width,e.height);var o=this.context;var u=s.width;var a=s.height;var f=u/(t.length-1);var l=a/(r-i);var c=[];var h;o.beginPath();o.moveTo(0,a+i*l);for(h=0;h<t.length;h++){var p=h*f;var d=a-l*(t[h]-i);c.push({x:p,y:d});o.lineTo(p,d)}o.lineTo(u,a+i*l);o.fillStyle=e.colour;o.fill();if(e.strokeWidth){o.beginPath();o.moveTo(0,c[0].y);for(h=0;h<c.length;h++){o.lineTo(c[h].x,c[h].y)}o.lineWidth=e.strokeWidth*n;o.strokeStyle=e.strokeColour;o.stroke()}});i.register("bar",{baselineHeight:1,baselineColour:"#000000",fontColour:"#000000",fontStyle:"12pt Arial, sans-serif",focusWidth:0,focusColour:"#000",colours:["#4D89F9"],delimiter:",",height:16,max:null,min:0,spacing:1,width:32},function(e){var t,n,r,i,s,o,u,a;var f=this.values();var l=Math.max.apply(Math,f.concat([e.max]));var c=Math.min.apply(Math,f.concat([e.min]));var h=this.$el;var p=h.data("position");var d=this.prepareCanvas(e.width,e.height);var v=this.context;var m=e.spacing;var g=this.colours();var y=e.focusWidth;var b=d.width-m*2;var w=d.height-m*2;if(e.baselineHeight)w-=1;var E=w/(l-c);var S=(b+m)/f.length;var x=E*l+m;v.fillStyle=e.baselineColour;v.fillRect(0,x-e.baselineHeight/2,d.width,e.baselineHeight);for(t=0;t<f.length;t++){n=m+t*S;s=S-m;o=f[t];r=m+w-E*(o-c);if(o==0){if(c>=0||l>0)r-=1;i=1}else{i=E*f[t]}v.fillStyle=g.call(this,o,t,f);v.fillRect(n,r,s,i)}if(y>0&&p){p=JSON.parse(p);for(t=0;t<f.length;t++){n=m+t*S;s=S-m;if(p.x>=n&&p.x<=n+s){o=f[t];r=m+w-E*(o-c);if(o==0){if(c>=0||l>0)r-=1;i=1}else{i=E*f[t]}u=r+(i<0?i:0);a=i<0?-i:i;if(p.y>=u&&p.y<=u+a){v.strokeStyle=e.focusColour;v.lineWidth=y;v.strokeRect(n-y/2,u-y/2,s+y,a+y);v.fillStyle=e.fontColour;v.font=e.fontStyle;if(p.x>d.width/2)v.textAlign="right";if(p.y<d.height/2){v.textBaseline="top";p.y+=20}v.fillText(o+"",p.x,p.y)}}}}if(y>0){d.addEventListener("mousemove",function T(e){this.removeEventListener("mousemove",T,false);var t=d.getBoundingClientRect();var n={x:e.clientX-t.left,y:e.clientY-t.top};h.data("position",JSON.stringify(n)).change()},false)}})})(jQuery,document,window.devicePixelRatio||1)