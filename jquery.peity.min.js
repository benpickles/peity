// Peity jQuery plugin version 1.2.0
// (c) 2013 Ben Pickles
//
// http://benpickles.github.io/peity
//
// Released under MIT license.
var mousePos;function getMousePos(b,a){var c=b.getBoundingClientRect();return{x:a.clientX-c.left,y:a.clientY-c.top}}(function(f,b,d,a){var g=b.createElement("canvas").getContext;var e=f.fn.peity=function(j,i){if(g){this.each(function(){var o=f(this);var k=o.data("peity");if(k){if(j){k.type=j}f.extend(k.opts,i);k.draw()}else{var n=e.defaults[j];var m={};f.each(o.data(),function(p,q){if(p in n){m[p]=q}});var l=f.extend({},n,m,i);var k=new h(o,j,l);k.draw();o.change(function(){k.draw()}).data("peity",k)}})}return this};var h=function(i,j,k){this.$el=i;this.type=j;this.opts=k};var c=h.prototype;c.colours=function(){var j=this.opts.colours;var i=j;if(!f.isFunction(i)){i=function(k,l){return j[l%j.length]}}return i};c.draw=function(){e.graphers[this.type].call(this,this.opts)};c.prepareCanvas=function(k,i){var j=this.canvas;var l;if(j){this.context.clearRect(0,0,j.width,j.height);l=f(j)}else{l=f("<canvas>").css({height:i,width:k}).addClass("peity").data("peity",this);this.canvas=j=l[0];this.context=j.getContext("2d");this.$el.hide().after(j)}j.height=l.height()*a;j.width=l.width()*a;return j};c.values=function(){return f.map(this.$el.text().split(this.opts.delimiter),function(i){return parseFloat(i)})};e.defaults={};e.graphers={};e.register=function(i,j,k){this.defaults[i]=j;this.graphers[i]=k};e.register("pie",{colours:["#ff9900","#fff4dd","#ffc66e"],delimiter:null,diameter:16},function(j){if(!j.delimiter){var k=this.$el.text().match(/[^0-9\.]/);j.delimiter=k?k[0]:","}var y=this.values();if(j.delimiter=="/"){var x=y[0];var u=y[1];y=[x,u-x]}var q=0;var o=y.length;var t=0;for(;q<o;q++){t+=y[q]}var n=this.prepareCanvas(j.width||j.diameter,j.height||j.diameter);var m=this.context;var l=n.width;var z=n.height;var s=d.min(l,z)/2;var r=d.PI;var p=this.colours();m.save();m.translate(l/2,z/2);m.rotate(-r/2);for(q=0;q<o;q++){var w=y[q];var v=(w/t)*r*2;m.beginPath();m.moveTo(0,0);m.arc(0,0,s,0,v,false);m.fillStyle=p.call(this,w,q,y);m.fill();m.rotate(v)}m.restore()});e.register("line",{colour:"#c6d9fd",strokeColour:"#4d89f9",strokeWidth:1,delimiter:",",height:16,max:null,min:0,width:32},function(k){var v=this.values();if(v.length==1){v.push(v[0])}var s=d.max.apply(d,v.concat([k.max]));var o=d.min.apply(d,v.concat([k.min]));var n=this.prepareCanvas(k.width,k.height);var m=this.context;var l=n.width;var w=n.height;var j=l/(v.length-1);var q=w/(s-o);var u=[];var p;m.beginPath();m.moveTo(0,w+(o*q));for(p=0;p<v.length;p++){var t=p*j;var r=w-(q*(v[p]-o));u.push({x:t,y:r});m.lineTo(t,r)}m.lineTo(l,w+(o*q));m.fillStyle=k.colour;m.fill();if(k.strokeWidth){m.beginPath();m.moveTo(0,u[0].y);for(p=0;p<u.length;p++){m.lineTo(u[p].x,u[p].y)}m.lineWidth=k.strokeWidth*a;m.strokeStyle=k.strokeColour;m.stroke()}});e.register("bar",{baselineColour:"#000000",fontColour:"#000000",fontStyle:"12pt Arial, sans-serif",colours:["#4D89F9"],delimiter:",",height:16,max:null,min:0,spacing:a,width:32},function(s){var j=this.values();var B=d.max.apply(d,j.concat([s.max]));var A=d.min.apply(d,j.concat([s.min]));var k=this.$el;var m=this.prepareCanvas(s.width,s.height);var l=this.context;var v=m.width-6;var u=m.height-7;var E=u/(B-A);var F=s.spacing;var o=(v+F)/j.length;var H=this.colours();var t=E*B+3;for(var C=0;C<j.length;C++){var z=j[C];var p=3+u-(E*(z-A));var D;if(z==0){if(A>=0||B>0){p-=1}D=1}else{D=E*j[C]}var q=3+C*o;var r=o-F;l.fillStyle=H.call(this,z,C,j);l.fillRect(q,p,r,D)}l.fillStyle=s.baselineColour;l.fillRect(0,E*B+3,m.width,3);for(var C=0;C<j.length;C++){var z=j[C];var p=3+u-(E*(z-A));var D;if(z==0){if(A>=0||B>0){p-=1}D=1}else{D=E*j[C]}var q=3+C*o;var r=o-F;if(mousePos){if(mousePos.x>=q&&mousePos.x<=q+r){var G=D<0?p+D:p;var n=D<0?-D:D;if(mousePos.y>=G&&mousePos.y<=G+n){l.strokeRect(q-1,p>t?p+1:p-1,r+2,p>t?D+1:D+2);l.fillStyle=s.fontColour;l.font=s.fontStyle;if(q>m.width/2){l.textAlign="right"}l.fillText(z,q,t-4)}}}}m.addEventListener("mousemove",function(i){this.removeEventListener("mousemove",arguments.callee,false);console.log("move");mousePos=getMousePos(m,i);k.change()},false)})})(jQuery,document,Math,window.devicePixelRatio||1);
