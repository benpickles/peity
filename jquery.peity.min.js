// Peity jQuery plugin version 0.6.1
// (c) 2012 Ben Pickles
//
// http://benpickles.github.com/peity/
//
// Released under MIT license.
(function(e,t){function i(e,n){var i=t.createElement("canvas");i.setAttribute("width",e*r);i.setAttribute("height",n*r);if(r!=1){var s="width:"+e+"px;height:"+n+"px";i.setAttribute("style",s)}return i}var n=e.fn.peity=function(r,i){if(t.createElement("canvas").getContext){this.each(function(){e(this).change(function(){var t=e.extend({},n.defaults[r],i);var s=this;e.each(t,function(n,r){if(e.isFunction(r))t[n]=r.call(s)});var o=e(this).html();n.graphers[r].call(this,t);e(this).trigger("chart:changed",o)}).trigger("change")})}return this};n.graphers={};n.defaults={};n.add=function(e,t,r){n.graphers[e]=r;n.defaults[e]=t};var r=window.devicePixelRatio||1;n.add("pie",{colours:["#FFF4DD","#FF9900"],delimeter:"/",diameter:16},function(t){var n=e(this);var r=n.text().split(t.delimeter);var s=parseFloat(r[0]);var o=parseFloat(r[1]);var u=s/o*Math.PI*2;var a=e(this).find("canvas")[0];if(!a){a=i(t.diameter,t.diameter);n.wrapInner(e("<span>").hide()).append(a)}var f=a.getContext("2d");var l=a.width/2;f.translate(l,l);f.rotate(-Math.PI/2);f.clearRect(0,0,a.width,a.height);f.beginPath();f.moveTo(0,0);f.arc(0,0,l,0,u==0?Math.PI*2:u,true);f.fillStyle=t.colours[0];f.fill();f.beginPath();f.moveTo(0,0);f.arc(0,0,l,0,u,false);f.fillStyle=t.colours[1];f.fill()});n.add("line",{colour:"#c6d9fd",strokeColour:"#4d89f9",strokeWidth:1,delimeter:",",height:16,max:null,min:0,width:32},function(t){var n=e(this);var s=e(this).find("canvas")[0];if(!s){s=i(t.width,t.height);n.wrapInner(e("<span>").hide()).append(s)}var o=n.text().split(t.delimeter);if(o.length==1)o.push(o[0]);var u=Math.max.apply(Math,o.concat([t.max]));var a=Math.min.apply(Math,o.concat([t.min]));var f=s.getContext("2d");var l=s.width;var c=s.height;var h=l/(o.length-1);var p=c/(u-a);var d=[];var v;f.clearRect(0,0,s.width,s.height);f.beginPath();f.moveTo(0,c+a*p);for(v=0;v<o.length;v++){var m=v*h;var g=c-p*(o[v]-a);d.push({x:m,y:g});f.lineTo(m,g)}f.lineTo(l,c+a*p);f.fillStyle=t.colour;f.fill();if(t.strokeWidth){f.beginPath();f.moveTo(0,d[0].y);for(v=0;v<d.length;v++){f.lineTo(d[v].x,d[v].y)}f.lineWidth=t.strokeWidth*r;f.strokeStyle=t.strokeColour;f.stroke()}});n.add("bar",{colour:"#4D89F9",delimeter:",",height:16,max:null,min:0,width:32},function(t){var n=e(this);var s=n.text().split(t.delimeter);var o=Math.max.apply(Math,s.concat([t.max]));var u=Math.min.apply(Math,s.concat([t.min]));var a=e(this).find("canvas")[0];if(!a){a=i(t.width,t.height);n.wrapInner(e("<span>").hide()).append(a)}var f=a.getContext("2d");var l=a.width;var c=a.height;var h=c/(o-u);var p=r/2;var d=(l+p)/s.length;f.clearRect(0,0,a.width,a.height);f.fillStyle=t.colour;for(var v=0;v<s.length;v++){var m=v*d;var g=c-h*(s[v]-u);f.fillRect(m,g,d-p,h*s[v])}})})(jQuery,document)