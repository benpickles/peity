// Peity jQuery plugin version 1.2.1
// (c) 2013 Ben Pickles
//
// http://benpickles.github.io/peity
//
// Released under MIT license.
(function(s,q){var D=document.createElement("canvas").getContext,t=s.fn.peity=function(a,c){D&&this.each(function(){var b=s(this),e=b.data("peity");if(e)a&&(e.type=a),s.extend(e.opt,c),e.draw();else{var l=t.defaults[a],d={};s.each(b.data(),function(a,b){a in l&&(d[a]=b)});var g=s.extend({},l,d,c),e=new x(b,a,g);e.draw();b.change(function(a,b,c){e.draw()}).data("peity",e)}});return this},x=function(a,c,b){this.$el=a;this.type=c;this.opt=b},k=x.prototype;k.fill=function(){var a=this.opt.fill;return s.isFunction(a)?
a:function(c,b){return a[b%a.length]}};k.draw=function(){t.graphers[this.type].call(this,this.opt)};k.prepareCanvas=function(a,c){var b=this.canvas,e;b?b.width=b.width:(e=s("<canvas>").css({height:c,width:a}).addClass("peity").data("peity",this),this.canvas=b=e[0],this.context=b.getContext("2d"),this.$el.hide().after(b),b.height=e.height(),b.width=e.width());return b};k.hoverEvent=function(a){k.removeEvents(this);var c=this.getBoundingClientRect();s(this).prev().data("mouse",JSON.stringify({x:a.clientX-
c.left,y:a.clientY-c.top})).change()};k.exitEvent=function(a){k.removeEvents(this);s(this).prev().removeData("mouse").change()};k.removeEvents=function(a){a.removeEventListener("mouseout",a.exitEvent,!1);a.removeEventListener("mousemove",a.hoverEvent,!1)};k.addEvents=function(a){a.addEventListener("mousemove",k.hoverEvent,!1);a.addEventListener("mouseout",k.exitEvent,!1)};k.values=function(){var a=this.opt.delimiter,c=this.opt.seriesDelimiter,b=this.$el.text(),e=function(b){return b.split(a).map(function(a){return parseFloat(a)})};
return c?b.split(c).map(e):e(b)};k.setLineStyle=function(a,c,b){a.lineWidth=b;a.strokeStyle=c};k.drawArc=function(a,c,b,e,l,d){a.beginPath();a.arc(0,0,c,b,e,!0);k.setLineStyle(a,l,d);a.stroke()};t.defaults={};t.graphers={};t.register=function(a,c,b){this.defaults[a]=c;this.graphers[a]=b};t.register("pie",{fill:["#f90","#ffd","#fc6"],delimiter:null,diameter:16,lineColor:"#000",lineWidth:0,focusColor:"#000",focusWidth:0},function(a){if(!a.delimiter){var c=this.$el.text().match(/[^0-9\.]/);a.delimiter=
c?c[0]:","}c=this.values();"/"===a.delimiter&&(c=[c[0],c[1]-c[0]]);var b,e=0,l=c.length;for(b=0;b<l;b++)e+=c[b];var d=this.$el.data("mouse"),g=a.focusWidth,m=a.lineWidth,f=q.max(g,m)+1,w=a.diameter,w=this.prepareCanvas(w+f,w+f),h=this.context;b=w.width;var p=w.height,f=b/2-f,r=2*q.PI,e=r/e,n=this.fill();if(g&&d){d=JSON.parse(d);d.x-=b/2;d.y-=p/2;d.y*=-1;d.r=q.sqrt(d.x*d.x+d.y*d.y);for(d.a=q.atan2(d.y,d.x);0>d.a;)d.a+=r;for(;d.a>r;)d.a-=r}h.translate(b/2,p/2);var k,u=0;for(b=0;b<l;b++)p=c[b],k=p*e,
h.beginPath(),h.moveTo(0,0),h.arc(0,0,f,-u,-(u+k),!0),h.fillStyle=n.call(this,p,b,c),h.fill(),g&&d&&d.a>u&&d.a<u+k&&this.drawArc(h,f+g/2,-u,-(u+k),a.focusColor,g),u+=k;m&&this.drawArc(h,f+m/2,0,r,a.lineColor,m);g&&this.addEvents(w)});t.register("line",{fill:"#cdf",lineColor:"#48f",lineWidth:1,delimiter:",",height:16,width:32,max:null,min:0},function(a){var c=this.values();1==c.length&&c.push(c[0]);var b=q.max.apply(q,c.concat([a.max])),e=q.min.apply(q,c.concat([a.min])),l=a.lineWidth,d=this.prepareCanvas(a.width,
a.height),g=this.context,m=d.width,d=d.height-l,f=m/(c.length-1),b=d/(b-e),k=[],h;g.beginPath();g.moveTo(0,d+e*b);for(h=0;h<c.length;h++){var p=h*f,r=d-b*(c[h]-e)+l/2;k.push({x:p,y:r});g.lineTo(p,r)}g.lineTo(m,d+e*b);a.fill&&(g.fillStyle=a.fill,g.fill());if(l){g.beginPath();g.moveTo(0,k[0].y);for(h=0;h<k.length;h++)g.lineTo(k[h].x,k[h].y);this.setLineStyle(g,a.lineColor,l);g.stroke()}});t.register("lines",{lineColors:["#666666","#803E75"],lineWidths:[1],delimiter:",",seriesDelimiter:"|",height:16,
width:32,max:null,min:0,pointSize:2,gridlines:[1,1],gridlineColors:["#000","#bbb"]},function(a){var c=this.values(),b=a.pointSize,e=[].concat.apply([a.max,a.min],c),l=q.max.apply(q,e),e=q.min.apply(q,e),d=a.region||(l-e)/5,g=this.prepareCanvas(a.width,a.height),m=this.context,f=g.width-2*b,g=g.height,k=f/(c[0].length-1),h=g/(l-e),p=a.lineColors,r=a.lineWidths,n=a.gridlines,s=a.gridlineColors;n[0]&&(m.beginPath(),m.moveTo(0,g-h*(0-e)),m.lineTo(f+2*b,g-h*(0-e)),this.setLineStyle(m,s[0],n[0]),m.stroke());
if(n[1])for(this.setLineStyle(m,s[1],n[1]),n=e;n<=l;n+=d)m.beginPath(),m.moveTo(0,g-h*(n-e)),m.lineTo(f+2*b,g-h*(n-e)),m.stroke();for(n=0;n<c.length;n+=1){d=c[n];f=[];for(l=0;l<d.length;l++)f.push({x:l*k+b,y:g-h*(d[l]-e)}),m.beginPath(),m.arc(f[l].x,f[l].y,a.pointSize,0,2*q.PI,!1),m.fillStyle=p[n%p.length],m.fill();m.beginPath();m.moveTo(0,f[0].y);for(l=0;l<f.length;l++)m.lineTo(f[l].x,f[l].y);this.setLineStyle(m,p[n%p.length],r[n%r.length]);m.stroke()}});t.register("bar",{fill:["#48f"],fontColor:"#000",
fontSize:13,formatter:function(a){return a},focusColor:"#000",focusWidth:0,height:16,width:32,left:0,max:null,min:0,delimiter:",",gap:1,gridlines:[1,1],gridlineColors:["#000","#bbb"]},function(a){var c,b,e=this.values();c=q.max.apply(q,e.concat([a.max]));var l=q.min.apply(q,e.concat([a.min])),d=a.region||(c-l)/5,g=this.$el.data("mouse"),m=this.prepareCanvas(a.width,a.height),f=this.context,k=a.gap,h=this.fill(),p=a.focusWidth,r=a.gridlines,n=a.gridlineColors,s=a.fontSize,u=a.fontColor,t=a.formatter,
z=m.width,x=m.height,y=a.left,A=x-2*k-r[0],B=A/(c-l),C=(z-2*k-y+k)/e.length,v=function(){return A-B*(b-l)+k};r[0]&&(b=0,f.beginPath(),f.moveTo(y,v()),f.lineTo(z,v()),this.setLineStyle(f,n[0],r[0]),f.stroke());if(r[1])for(this.setLineStyle(f,n[1],r[1]),b=l;b<=c;b+=d)f.beginPath(),f.moveTo(y,v()),f.lineTo(z,v()),f.stroke(),f.fillStyle=a.fontColor,f.font=s+"px sans-serif",f.textAlign="right",f.textBaseline=v()>s/2?v()>A?"bottom":"middle":"top",f.fillText(t(b)+"",y-1,v());d=[];for(c=0;c<e.length;c++)b=
e[c],d.push([k+c*C+y,v(),C-k,0===b?1:B*b]),f.fillStyle=h.call(this,b,c,e),f.fillRect.apply(f,d[c]);if(p&&g)for(g=JSON.parse(g),c=0;c<d.length;c++)if(h=d[c],g.x>=h[0]&&g.x<=h[0]+h[2]){h[1]+=q.min(h[3],0);h[3]=q.abs(h[3]);g.y>=h[1]&&g.y<=h[1]+h[3]&&(this.setLineStyle(f,a.focusColor,p),f.strokeRect(h[0]-p/2,h[1]-p/2,h[2]+p,h[3]+p),f.fillStyle=u,f.font=s,g.x>z/2&&(f.textAlign="right"),g.y<x/2&&(f.textBaseline="top",g.y+=20),f.fillText(t(e[c])+"",g.x,g.y));break}p&&this.addEvents(m)})})(jQuery,Math);
