// Peity jQuery plugin version 1.2.1
// (c) 2013 Ben Pickles
//
// http://benpickles.github.io/peity
//
// Released under MIT license.
(function(l,q){var C=document.createElement("canvas").getContext,r=l.fn.peity=function(a,c){C&&this.each(function(){var b=l(this),g=b.data("peity");if(g)a&&(g.type=a),l.extend(g.opt,c),g.draw();else{var f=r.defaults[a],d={};l.each(b.data(),function(a,b){a in f&&(d[a]=b)});var e=l.extend({},f,d,c),g=new w(b,a,e);g.draw();b.change(function(a,b,c){g.draw()}).data("peity",g)}});return this},w=function(a,c,b){this.$el=a;this.type=c;this.opt=b},h=w.prototype;h.fill=function(){var a=this.opt.fill;return l.isFunction(a)?
a:function(c,b){return a[b%a.length]}};h.draw=function(){r.graphers[this.type].call(this,this.opt)};h.prepareCanvas=function(a,c){var b=this.canvas,g;b?b.width=b.width:(g=l("<canvas>").css({height:c,width:a}).addClass("peity").data("peity",this),this.canvas=b=g[0],this.context=b.getContext("2d"),this.$el.hide().after(b),b.height=g.height(),b.width=g.width());return b};h.hoverEvent=function(a){h.removeEvents(this);var c=this.getBoundingClientRect();l(this).prev().data("mouse",JSON.stringify({x:a.clientX-
c.left,y:a.clientY-c.top})).change()};h.exitEvent=function(a){h.removeEvents(this);l(this).prev().removeData("mouse").change()};h.removeEvents=function(a){a.removeEventListener("mouseout",a.exitEvent,!1);a.removeEventListener("mousemove",a.hoverEvent,!1)};h.addEvents=function(a){a.addEventListener("mousemove",h.hoverEvent,!1);a.addEventListener("mouseout",h.exitEvent,!1)};h.values=function(){var a=this.opt.delimiter,c=this.opt.seriesDelimiter,b=this.$el.text(),g=function(b){return b.split(a).map(function(a){return parseFloat(a)})};
return c?b.split(c).map(g):g(b)};h.setLineStyle=function(a,c,b){a.lineWidth=b;a.strokeStyle=c};h.drawArc=function(a,c,b,g,f,d){a.beginPath();a.arc(0,0,c,b,g,!0);h.setLineStyle(a,f,d);a.stroke()};h.drawGridlines=function(a,c,b,g,f,d,e,v,m,k,n,u,q,h,s,p){var t=function(){return n-u*(l-q)+p},l=0;c&&(a.beginPath(),a.moveTo(m,t()),a.lineTo(k,t()),this.setLineStyle(a,g,c),a.stroke());if(b)for(this.setLineStyle(a,f,b),l=q;l<=h;l+=s)a.beginPath(),a.moveTo(m,t()),a.lineTo(k,t()),a.stroke(),a.fillStyle=d,a.font=
e+"px sans-serif",a.textAlign="right",a.textBaseline=t()>e/2?t()>n-e/2?"bottom":"middle":"top",a.fillText(v(l)+"",m-1,t())};r.defaults={};r.graphers={};r.register=function(a,c,b){this.defaults[a]=c;this.graphers[a]=b};r.register("pie",{fill:["#f90","#ffd","#fc6"],delimiter:null,diameter:16,lineColor:"#000",lineWidth:0,focusColor:"#000",focusWidth:0},function(a){if(!a.delimiter){var c=this.$el.text().match(/[^0-9\.]/);a.delimiter=c?c[0]:","}c=this.values();"/"===a.delimiter&&(c=[c[0],c[1]-c[0]]);var b,
g=0,f=c.length;for(b=0;b<f;b++)g+=c[b];var d=this.$el.data("mouse"),e=a.focusWidth,v=a.lineWidth,m=q.max(e,v)+1,k=a.diameter,k=this.prepareCanvas(k+m,k+m),n=this.context;b=k.width;var u=k.height,m=b/2-m,h=2*q.PI,g=h/g,l=this.fill();if(e&&d){d=JSON.parse(d);d.x-=b/2;d.y-=u/2;d.y*=-1;d.r=q.sqrt(d.x*d.x+d.y*d.y);for(d.a=q.atan2(d.y,d.x);0>d.a;)d.a+=h;for(;d.a>h;)d.a-=h}n.translate(b/2,u/2);var s,p=0;for(b=0;b<f;b++)u=c[b],s=u*g,n.beginPath(),n.moveTo(0,0),n.arc(0,0,m,-p,-(p+s),!0),n.fillStyle=l.call(this,
u,b,c),n.fill(),e&&d&&d.a>p&&d.a<p+s&&this.drawArc(n,m+e/2,-p,-(p+s),a.focusColor,e),p+=s;v&&this.drawArc(n,m+v/2,0,h,a.lineColor,v);e&&this.addEvents(k)});r.register("line",{fill:"#cdf",lineColor:"#48f",lineWidth:1,delimiter:",",height:16,width:32,max:null,min:0},function(a){var c=this.values();1==c.length&&c.push(c[0]);var b=q.max.apply(q,c.concat([a.max])),g=q.min.apply(q,c.concat([a.min])),f=a.lineWidth,d=this.prepareCanvas(a.width,a.height),e=this.context,h=d.width,d=d.height-f,m=h/(c.length-
1),b=d/(b-g),k=[],n;e.beginPath();e.moveTo(0,d+g*b);for(n=0;n<c.length;n++){var u=n*m,l=d-b*(c[n]-g)+f/2;k.push({x:u,y:l});e.lineTo(u,l)}e.lineTo(h,d+g*b);a.fill&&(e.fillStyle=a.fill,e.fill());if(f){e.beginPath();e.moveTo(0,k[0].y);for(n=0;n<k.length;n++)e.lineTo(k[n].x,k[n].y);this.setLineStyle(e,a.lineColor,f);e.stroke()}});r.register("lines",{lineColors:["#666666","#803E75"],lineWidths:[1],fontColor:"#000",fontSize:13,formatter:function(a){return a},delimiter:",",seriesDelimiter:"|",height:16,
width:32,left:0,max:null,min:0,pointSize:2,gridlines:[1,1],gridlineColors:["#000","#bbb"]},function(a){var c=this.values(),b,g=a.pointSize,f=[].concat.apply([a.max,a.min],c);b=q.max.apply(q,f);var f=q.min.apply(q,f),d=a.region||(b-f)/5,e=this.prepareCanvas(a.width,a.height),h=this.context,m=a.left,k=e.width,e=e.height,n=(k-2*g-m)/(c[0].length-1),l=e/(b-f),r=a.lineColors,x=a.lineWidths,s=a.gridlines,p=a.gridlineColors;this.drawGridlines(h,s[0],s[1],p[0],p[1],a.fontColor,a.fontSize,a.formatter,m,k,
e,l,f,b,d,0);for(k=0;k<c.length;k+=1){s=c[k];p=[];for(d=0;d<s.length;d++)b=s[d],p.push({x:d*n+g+m,y:e-l*(b-f)}),h.beginPath(),h.arc(p[d].x,p[d].y,a.pointSize,0,2*q.PI,!1),h.fillStyle=r[k%r.length],h.fill();h.beginPath();h.moveTo(m,p[0].y);for(d=0;d<p.length;d++)h.lineTo(p[d].x,p[d].y);this.setLineStyle(h,r[k%r.length],x[k%x.length]);h.stroke()}});r.register("bar",{fill:["#48f"],fontColor:"#000",fontSize:13,formatter:function(a){return a},focusColor:"#000",focusWidth:0,height:16,width:32,left:0,max:null,
min:0,delimiter:",",gap:1,gridlines:[1,1],gridlineColors:["#000","#bbb"]},function(a){var c,b,g=this.values();c=q.max.apply(q,g.concat([a.max]));var f=q.min.apply(q,g.concat([a.min])),d=a.region||(c-f)/5,e=this.$el.data("mouse"),h=this.prepareCanvas(a.width,a.height),m=this.context,k=a.gap,n=this.fill(),l=a.focusWidth;b=a.gridlines;var r=a.gridlineColors,x=a.fontSize,s=a.fontColor,p=a.formatter,t=h.width,w=h.height,y=a.left,z=w-2*k-b[0],A=z/(c-f),B=(t-2*k-y+k)/g.length;this.drawGridlines(m,b[0],b[1],
r[0],r[1],s,x,p,y,t,z,A,f,c,d,k);d=[];for(c=0;c<g.length;c++)b=g[c],d.push([k+c*B+y,z-A*(b-f)+k,B-k,0===b?1:A*b]),m.fillStyle=n.call(this,b,c,g),m.fillRect.apply(m,d[c]);if(l&&e)for(e=JSON.parse(e),c=0;c<d.length;c++)if(f=d[c],e.x>=f[0]&&e.x<=f[0]+f[2]){f[1]+=q.min(f[3],0);f[3]=q.abs(f[3]);e.y>=f[1]&&e.y<=f[1]+f[3]&&(this.setLineStyle(m,a.focusColor,l),m.strokeRect(f[0]-l/2,f[1]-l/2,f[2]+l,f[3]+l),m.fillStyle=s,m.font=x,e.x>t/2&&(m.textAlign="right"),e.y<w/2&&(m.textBaseline="top",e.y+=20),m.fillText(p(g[c])+
"",e.x,e.y));break}l&&this.addEvents(h)})})(jQuery,Math);
