// Peity jQuery plugin version 1.2.1
// (c) 2013 Ben Pickles
//
// http://benpickles.github.io/peity
//
// Released under MIT license.
(function(t,m){var J=document.createElement("canvas").getContext,B={color:"#000",size:13,formatter:function(a){return a}},v=t.fn.peity=function(a,b){J&&this.each(function(){var c=t(this),e=c.data("peity");if(e)a&&(e.type=a),t.extend(!0,e.opt,b),e.draw();else{var d=v.defaults[a],f={};t.each(c.data(),function(a,b){a in d&&(f[a]=b)});var p=t.extend(!0,{},d,f,b),e=new I(c,a,p);e.draw();c.change(function(a,b,c){e.draw()}).data("peity",e)}});return this},I=function(a,b,c){this.$el=a;this.type=b;this.opt=
c},g=I.prototype;g.fill=function(){var a=this.opt.fill;return t.isFunction(a)?a:function(b,c){return a[c%a.length]}};g.draw=function(){v.graphers[this.type].call(this,this.opt)};g.prepareCanvas=function(a,b){var c=this.canvas,e;c?c.width=c.width:(e=t("<canvas>").css({height:b,width:a}).addClass("peity").data("peity",this),this.canvas=c=e[0],this.context=c.getContext("2d"),this.$el.hide().after(c),c.height=e.height(),c.width=e.width());return c};g.hoverEvent=function(a){g.removeEvents(this);var b=
this.getBoundingClientRect();t(this).prev().data("mouse",JSON.stringify({x:a.clientX-b.left,y:a.clientY-b.top})).change()};g.exitEvent=function(a){g.removeEvents(this);t(this).prev().removeData("mouse").change()};g.removeEvents=function(a){a.removeEventListener("mouseout",a.exitEvent,!1);a.removeEventListener("mousemove",a.hoverEvent,!1)};g.addEvents=function(a){a.addEventListener("mousemove",g.hoverEvent,!1);a.addEventListener("mouseout",g.exitEvent,!1)};g.values=function(){var a=this.opt.delimiter,
b=this.opt.seriesDelimiter,c=this.$el.text(),e=function(b){return b.split(a).map(function(a){return parseFloat(a)})};return b?c.split(b).map(e):e(c)};g.setLineStyle=function(a,b,c){a.lineWidth=c;a.strokeStyle=b};g.drawArc=function(a,b,c,e,d,f,p,n){a.beginPath();a.arc(b,c,e,d,f,!0);g.setLineStyle(a,p,n);a.stroke()};g.drawCircle=function(a,b,c,e,d,f,p){a.beginPath();a.moveTo(b,c);a.arc(b,c,e,d,f,!0);a.fillStyle=p;a.fill()};g.drawLine=function(a,b,c,e){a.beginPath();a.moveTo(b[0].x,b[0].y);for(var d=
1;d<b.length;d++)a.lineTo(b[d].x,b[d].y);this.setLineStyle(a,c,e);a.stroke()};g.drawYAxis=function(a,b,c,e,d,f,p,n,h,m,k,g,w,u,r,q){var l=function(){return k-g*(z-w)+q},z=0;b&&(a.beginPath(),a.moveTo(h,l()),a.lineTo(m,l()),this.setLineStyle(a,e,b),a.stroke());if(c)for(this.setLineStyle(a,d,c),z=w;z<=u;z+=r)a.beginPath(),a.moveTo(h,l()),a.lineTo(m,l()),a.stroke(),3<h&&(a.fillStyle=f,a.font=p+"px sans-serif",a.textAlign="right",a.textBaseline=l()>p/2?l()>k-p/2?"bottom":"middle":"top",a.fillText(n(z)+
"",h-1,l()))};g.drawXAxis=function(a,b,c,e,d,f){a.fillStyle=b;a.font=c+"px sans-serif";a.textBaseline="top";a.textAlign="center";for(b=0;b<d.length;b++)for(var p=f[b].split(" "),n=0;n<p.length;n++)a.fillText(p[n],d[b].x,e+1+n*c)};v.defaults={};v.graphers={};v.register=function(a,b,c){this.defaults[a]=b;this.graphers[a]=c};v.register("pie",{fill:["#f90","#ffd","#fc6"],lineColor:"#000",lineWidth:0,focusColor:"#000",focusWidth:0,delimiter:null,diameter:16},function(a){if(!a.delimiter){var b=this.$el.text().match(/[^0-9\.]/);
a.delimiter=b?b[0]:","}b=this.values();"/"===a.delimiter&&(b=[b[0],b[1]-b[0]]);var c,e=0,d=b.length;for(c=0;c<d;c++)e+=b[c];var f=this.$el.data("mouse"),p=a.focusWidth,n=a.lineWidth,h=m.max(p,n)+1,g=a.diameter,g=this.prepareCanvas(g+h,g+h),k=this.context;c=g.width;var y=g.height,h=c/2-h,w=2*m.PI,e=w/e,u=this.fill();if(p&&f){f=JSON.parse(f);f.x-=c/2;f.y-=y/2;f.y*=-1;f.r=m.sqrt(f.x*f.x+f.y*f.y);for(f.a=m.atan2(f.y,f.x);0>f.a;)f.a+=w;for(;f.a>w;)f.a-=w}k.translate(c/2,y/2);var r,q=0;for(c=0;c<d;c++)y=
b[c],r=y*e,this.drawCircle(k,0,0,h,-q,-(q+r),u.call(this,y,c,b)),p&&f&&f.a>q&&f.a<q+r&&this.drawArc(k,0,0,h+p/2,-q,-(q+r),a.focusColor,p),q+=r;n&&this.drawArc(k,0,0,h+n/2,0,w,a.lineColor,n);p&&this.addEvents(g)});v.register("lines",{lineColors:["#78A","#827"],lineWidths:[1],fill:"#cdf",delimiter:",",seriesDelimiter:"|",height:32,width:32,left:0,max:null,min:0,pointSizes:[2],xAxis:B,yAxis:B,focus:!1,tooltip:B,gridlines:{widths:[1,0],colors:["#000","#bbb"]}},function(a){var b=this.$el.data("mouse"),
c=this.values(),e,d=a.pointSizes,f=a.xAxis,p=a.yAxis,g=a.focus,h=a.tooltip,t=a.gridlines,k=[].concat.apply([a.max,a.min],c),y=a.labels;y&&(y=y.map(function(a){return a+""}));var w=0;y&&(w=m.max.apply(this,y.map(function(a){return a.replace(/[^ ]/g,"").length}))+1);var u=m.max.apply(m,k),r=m.min.apply(m,k),q=a.region||(u-r)/5,u=m.ceil(u/q)*q,r=m.floor(r/q)*q,k=this.prepareCanvas(a.width,a.height),l=this.context,z=a.left,A=w*f.size+(w?4:0),v=k.width,C=v-2*m.max.apply(m,d)-z,A=k.height-A,C=C/(c[0].length-
0.5),G=A/(u-r),E=a.lineColors,B=a.lineWidths,t=a.gridlines,s,x,H,D,F=[];for(x=0;x<c.length;x+=1){H=c[x];D=[];for(s=0;s<H.length;s++)e=H[s],D.push({x:s*C+d[x%d.length]+z+C/4,y:A-G*(e-r)});if(a.fill&&1===c.length){l.beginPath();e=0;l.moveTo(z+C/4+d[0],A-G*(e-r));for(s=0;s<D.length;s++)l.lineTo(D[s].x,D[s].y);e=0;l.lineTo(v-d[0]-C/4,A-G*(e-r));l.fillStyle=a.fill;l.fill()}F.push(D)}this.drawYAxis(l,t.widths[0],t.widths[1],t.colors[0],t.colors[1],p.color,p.size,p.formatter,z,v,A,G,r,u,q,0);for(x=0;x<c.length;x+=
1){D=F[x];for(s=0;s<D.length;s++)this.drawCircle(l,D[s].x,D[s].y,d[x%d.length],0,2*m.PI,E[x%E.length]);this.drawLine(l,D,E[x%E.length],B[x%B.length])}w&&this.drawXAxis(l,f.color,f.size,A,F[0],y);if(g&&b)for(b=JSON.parse(b),s=0;s<F[0].length;s++)if(a=F[0][s],b.x>=a.x-C/3&&b.x<=a.x+C/3){l.font=h.size+"px sans-serif";l.textAlign="right";b.y<A/2?(l.textBaseline="top",b.y+=h.size):(l.textBaseline="bottom",b.y-=h.size);c.forEach(function(a,c){l.fillStyle=E[c%E.length];l.fillText((h.formatter(a[s])||" ")+
" \u25a0",b.x,b.y+c*h.size)});break}g&&this.addEvents(k)});v.register("bar",{fill:["#48f"],delimiter:",",height:16,width:32,left:0,gap:1,xAxis:B,yAxis:B,focus:{color:"#000",width:0},tooltip:B,gridlines:{widths:[1,0],colors:["#000","#bbb"]},max:null,min:0},function(a){var b,c,e=this.values(),d=a.labels;d&&(d=d.map(function(a){return a+""}));var f=0;d&&(f=m.max.apply(this,d.map(function(a){return a.replace(/[^ ]/g,"").length}))+1);b=m.max.apply(m,e.concat([a.max]));var g=m.min.apply(m,e.concat([a.min])),
n=a.region||(b-g)/5;b=m.ceil(b/n)*n;var g=m.floor(g/n)*n,h=this.$el.data("mouse"),t=this.prepareCanvas(a.width,a.height),k=this.context,y=this.fill();c=a.yAxis;var w=a.xAxis,u=a.focus,r=a.tooltip,q=a.gridlines,l=t.width,z=t.height,A=a.gap;a=a.left;var v=z-(f*w.size+(f?4:0))-q.widths[0],C=v/(b-g),B=(l-2*A-a+A)/e.length;this.drawYAxis(k,q.widths[0],q.widths[1],q.colors[0],q.colors[1],c.color,c.size,c.formatter,a,l,v,C,g,b,n,0);n=[];for(b=0;b<e.length;b++)c=e[b],n.push([a+b*B+A,v-C*(c-g),B-A,0===c?1:
C*c]),k.fillStyle=y.call(this,c,b,e),k.fillRect.apply(k,n[b]);f&&this.drawXAxis(k,w.color,w.size,v,n.map(function(a){return{x:a[0]+a[2]/2}}),d);if(u.width&&h)for(h=JSON.parse(h),b=0;b<n.length;b++)if(d=n[b],h.x>=d[0]&&h.x<=d[0]+d[2]){d[1]+=m.min(d[3],0);d[3]=m.abs(d[3]);h.y>=d[1]&&h.y<=d[1]+d[3]&&(this.setLineStyle(k,u.color,u.width),k.strokeRect(d[0]-u.width/2,d[1]-u.width/2,d[2]+u.width,d[3]+u.width),k.fillStyle=r.color,k.font=r.size+"px sans-serif",h.x>l/2&&(k.textAlign="right"),h.y<z/2?(k.textBaseline=
"top",h.y+=20):k.textBaseline="bottom",k.fillText(r.formatter(e[b])+"",h.x,h.y));break}u.width&&this.addEvents(t)})})(jQuery,Math);
