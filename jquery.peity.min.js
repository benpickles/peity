!function(t,e){var i=document.createElement("canvas").getContext,n=t.fn.peity=function(e,a){return i&&this.each(function(){var i=t(this),r=i.data("peity");if(r)e&&(r.type=e),t.extend(r.opt,a),r.draw();else{var o=n.defaults[e],h={};t.each(i.data(),function(t,e){t in o&&(h[t]=e)});var s=t.extend({},o,h,a);r=new l(i,e,s),r.draw(),i.change(function(){r.draw()}).data("peity",r)}}),this},l=function(t,e,i){this.$el=t,this.type=e,this.opt=i},a=l.prototype;a.fill=function(){var e=this.opt.fill;return t.isFunction(e)?e:function(t,i){return e[i%e.length]}},a.draw=function(){n.graphers[this.type].call(this,this.opt)},a.prepareCanvas=function(e,i){var n,l=this,a=l.canvas;return a?a.width=a.width:(n=t("<canvas>").css({height:i,width:e}).addClass("peity").data("peity",l),l.canvas=a=n[0],l.context=a.getContext("2d"),l.$el.hide().after(a),a.height=n.height(),a.width=n.width()),a},a.hoverEvent=function(e){a.removeEvents(this);var i=this.getBoundingClientRect();t(this).prev().data("mouse",JSON.stringify({x:e.clientX-i.left,y:e.clientY-i.top})).change()},a.exitEvent=function(){a.removeEvents(this),t(this).prev().removeData("mouse").change()},a.removeEvents=function(t){t.removeEventListener("mouseout",t.exitEvent,!1),t.removeEventListener("mousemove",t.hoverEvent,!1)},a.addEvents=function(t){t.addEventListener("mousemove",a.hoverEvent,!1),t.addEventListener("mouseout",a.exitEvent,!1)},a.values=function(){var t=this.opt.delimiter,e=this.opt.seriesDelimiter,i=this.$el.text(),n=function(e){return e.split(t).map(function(t){return parseFloat(t)})};return e?i.split(e).map(n):n(i)},a.drawArc=function(t,e,i,n,l,a){t.beginPath(),t.arc(0,0,e,i,n,!0),t.strokeStyle=l,t.lineWidth=a,t.stroke()},n.defaults={},n.graphers={},n.register=function(t,e,i){this.defaults[t]=e,this.graphers[t]=i},n.register("pie",{fill:["#f90","#ffd","#fc6"],delimiter:null,diameter:16,lineColor:"#000",lineWidth:0,focusColor:"#000",focusWidth:0},function(t){var i=this;if(!t.delimiter){var n=i.$el.text().match(/[^0-9\.]/);t.delimiter=n?n[0]:","}var l=i.values();"/"===t.delimiter&&(l=[l[0],l[1]-l[0]]);var a,r=0,o=l.length;for(a=0;o>a;a++)r+=l[a];var h=i.$el,s=h.data("mouse"),f=t.focusWidth,d=t.lineWidth,c=e.max(f,d)+1,u=t.diameter,v=i.prepareCanvas(u+c,u+c),p=i.context,m=v.width,g=v.height,y=m/2-c,x=e.PI,w=2*x,C=w/r,E=i.fill();if(f&&s){for(s=JSON.parse(s),s.x-=m/2,s.y-=g/2,s.y*=-1,s.r=e.sqrt(s.x*s.x+s.y*s.y),s.a=e.atan2(s.y,s.x);s.a<0;)s.a+=w;for(;s.a>w;)s.a-=w}p.translate(m/2,g/2);var S,W,k=0;for(a=0;o>a;a++)S=l[a],W=S*C,p.beginPath(),p.moveTo(0,0),p.arc(0,0,y,-k,-(k+W),!0),p.fillStyle=E.call(i,S,a,l),p.fill(),f&&s&&s.a>k&&s.a<k+W&&i.drawArc(p,y+f/2,-k,-(k+W),t.focusColor,f),k+=W;d&&i.drawArc(p,y+d/2,0,w,t.lineColor,d),f&&i.addEvents(v)}),n.register("line",{fill:"#cdf",lineColor:"#48f",lineWidth:1,delimiter:",",height:16,width:32,max:null,min:0},function(t){var i=this,n=i.values();1==n.length&&n.push(n[0]);var l,a=e.max.apply(e,n.concat([t.max])),r=e.min.apply(e,n.concat([t.min])),o=t.lineWidth,h=i.prepareCanvas(t.width,t.height),s=i.context,f=h.width,d=h.height-o,c=f/(n.length-1),u=d/(a-r),v=[];for(s.beginPath(),s.moveTo(0,d+r*u),l=0;l<n.length;l++){var p=l*c,m=d-u*(n[l]-r)+o/2;v.push({x:p,y:m}),s.lineTo(p,m)}if(s.lineTo(f,d+r*u),t.fill&&(s.fillStyle=t.fill,s.fill()),o){for(s.beginPath(),s.moveTo(0,v[0].y),l=0;l<v.length;l++)s.lineTo(v[l].x,v[l].y);s.lineWidth=o,s.strokeStyle=t.lineColor,s.stroke()}}),n.register("lines",{fill:["#666666","#803E75","#FF6800"],lineColor:"#4d89f9",lineWidth:1,delimiter:",",seriesDelimiter:"|",height:16,max:null,min:0,width:32},function(t){var i,n,l,a,r=this,o=r.values(),h=[t.max,t.min].concat.apply([],o),s=e.max.apply(e,h),f=e.min.apply(e,h),d=r.prepareCanvas(t.width,t.height),c=r.context,u=d.width,v=d.height,p=u/(o[1].length-1),m=v/(s-f),g=t.fill;for(c.lineWidth=t.lineWidth,a=[{x:0,y:v-m*(0-f)},{x:u,y:v-m*(0-f)}],c.beginPath(),c.moveTo(0,a[0].y),i=0;i<a.length;i++)c.lineTo(a[i].x,a[i].y);for(c.strokeStyle=g[0%g.length],c.stroke(),n=0;n<o.length;n+=1){for(l=o[n],a=[],i=0;i<l.length;i++)a.push({x:i*p,y:v-m*(l[i]-f)});for(c.beginPath(),c.moveTo(0,a[0].y),i=0;i<a.length;i++)c.lineTo(a[i].x,a[i].y);c.strokeStyle=g[(n+1)%g.length],c.stroke()}}),n.register("bar",{fill:["#48f"],axisColor:"#000",axisSize:1,fontColor:"#000",font:"12pt sans-serif",focusColor:"#000",focusWidth:0,height:16,width:32,max:null,min:0,delimiter:",",gap:1},function(t){var i,n,l,a,r,o,h=this,s=h.values(),f=e.max.apply(e,s.concat([t.max])),d=e.min.apply(e,s.concat([t.min])),c=h.$el.data("mouse"),u=h.prepareCanvas(t.width,t.height),v=h.context,p=t.gap,m=h.fill(),g=t.focusWidth,y=t.axisSize,x=u.width,w=u.height,C=x-2*p,E=w-2*p-y,S=E/(f-d),W=(C+p)/s.length,k=S*f+p;for(y&&(v.fillStyle=t.axisColor,v.fillRect(0,k-y/2,x,y)),i=0;i<s.length;i++)o=s[i],n=p+i*W,r=W-p,l=p+E-S*(o-d),a=S*o,v.fillStyle=m.call(h,o,i,s),v.fillRect(n,l,r,a);if(g&&c)for(c=JSON.parse(c),i=0;i<s.length;i++)if(n=p+i*W,r=W-p,c.x>=n&&c.x<=n+r){o=s[i],l=p+E-S*(o-d),a=0===o?1:S*s[i],l+=e.min(a,0),a=e.abs(a),c.y>=l&&c.y<=l+a&&(v.strokeStyle=t.focusColor,v.lineWidth=g,v.strokeRect(n-g/2,l-g/2,r+g,a+g),v.fillStyle=t.fontColor,v.font=t.font,c.x>x/2&&(v.textAlign="right"),c.y<w/2&&(v.textBaseline="top",c.y+=20),v.fillText(o+"",c.x,c.y));break}g&&h.addEvents(u)})}(jQuery,Math);