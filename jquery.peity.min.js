// Peity jQuery plugin version 1.2.0
// (c) 2013 Ben Pickles
//
// http://benpickles.github.io/peity
//
// Released under MIT license.
(function(e,b,a){var f=b.createElement("canvas").getContext;var d=e.fn.peity=function(i,h){if(f){this.each(function(){var n=e(this);var j=n.data("peity");if(j){if(i){j.type=i}e.extend(j.opts,h);j.draw()}else{var m=d.defaults[i];var l={};e.each(n.data(),function(o,p){if(o in m){l[o]=p}});var k=e.extend({},m,l,h);var j=new g(n,i,k);j.draw();n.change(function(p,o,q){j.draw()}).data("peity",j)}})}return this};var g=function(h,i,j){this.$el=h;this.type=i;this.opts=j};var c=g.prototype;c.colours=function(){var h=this.opts.colours;if(e.isFunction(h)){return h}else{return function(j,k){return h[k%h.length]}}};c.draw=function(){d.graphers[this.type].call(this,this.opts)};c.prepareCanvas=function(j,h){var i=this.canvas;var k;if(i){this.context.clearRect(0,0,i.width,i.height);k=e(i)}else{k=e("<canvas>").css({height:h,width:j}).addClass("peity").data("peity",this);this.canvas=i=k[0];this.context=i.getContext("2d");this.$el.hide().after(i)}i.height=k.height()*a;i.width=k.width()*a;return i};c.values=function(){return this.$el.text().split(this.opts.delimiter).map(function(h){return parseFloat(h)})};d.defaults={};d.graphers={};d.register=function(h,i,j){this.defaults[h]=i;this.graphers[h]=j};d.register("pie",{colours:["#ff9900","#fff4dd","#ffc66e"],delimiter:null,diameter:16},function(q){if(!q.delimiter){var y=this.$el.text().match(/[^0-9\.]/);q.delimiter=y?y[0]:","}var h=this.values();if(q.delimiter=="/"){var k=h[0];var j=h[1];h=[k,j-k]}var w,l=0,o=h.length;for(w=0;w<o;w++){l+=h[w]}var n=this.prepareCanvas((q.width||q.diameter)+1,(q.height||q.diameter)+1);var m=this.context;var t=n.width;var s=n.height;var p=Math.min(t,s)/2-2;var x=Math.PI;var r=2*x/l;var z=this.colours();m.save();m.translate(t/2,s/2);m.rotate(-x/2);var v,u;for(w=0;w<o;w++){v=h[w];u=v*r;m.beginPath();m.moveTo(0,0);m.arc(0,0,p,0,u,false);m.fillStyle=z.call(this,v,w,h);m.fill();m.rotate(u)}m.restore()});d.register("line",{colour:"#c6d9fd",strokeColour:"#4d89f9",strokeWidth:1,delimiter:",",height:16,max:null,min:0,width:32},function(j){var u=this.values();if(u.length==1){u.push(u[0])}var r=Math.max.apply(Math,u.concat([j.max]));var n=Math.min.apply(Math,u.concat([j.min]));var m=this.prepareCanvas(j.width,j.height);var l=this.context;var k=m.width;var v=m.height;var h=k/(u.length-1);var p=v/(r-n);var t=[];var o;l.beginPath();l.moveTo(0,v+(n*p));for(o=0;o<u.length;o++){var s=o*h;var q=v-(p*(u[o]-n));t.push({x:s,y:q});l.lineTo(s,q)}l.lineTo(k,v+(n*p));l.fillStyle=j.colour;l.fill();if(j.strokeWidth){l.beginPath();l.moveTo(0,t[0].y);for(o=0;o<t.length;o++){l.lineTo(t[o].x,t[o].y)}l.lineWidth=j.strokeWidth*a;l.strokeStyle=j.strokeColour;l.stroke()}});d.register("bar",{baselineHeight:1,baselineColour:"#000000",fontColour:"#000000",fontStyle:"12pt Arial, sans-serif",focusWidth:0,focusColour:"#000",colours:["#4D89F9"],delimiter:",",height:16,max:null,min:0,spacing:1,width:32},function(v){var E,t,s,G,u,B,H,p;var k=this.values();var D=Math.max.apply(Math,k.concat([v.max]));var C=Math.min.apply(Math,k.concat([v.min]));var l=this.$el;var I=l.data("position");var o=this.prepareCanvas(v.width,v.height);var m=this.context;var q=v.spacing;var K=this.colours();var j=v.focusWidth;var A=o.width-q*2;var z=o.height-q*2;if(v.baselineHeight){z-=1}var F=z/(D-C);var r=(A+q)/k.length;var J=F*D+q;m.fillStyle=v.baselineColour;m.fillRect(0,J-(v.baselineHeight/2),o.width,v.baselineHeight);for(E=0;E<k.length;E++){t=q+E*r;u=r-q;B=k[E];s=q+z-(F*(B-C));if(B==0){if(C>=0||D>0){s-=1}G=1}else{G=F*k[E]}m.fillStyle=K.call(this,B,E,k);m.fillRect(t,s,u,G)}if(j>0&&I){I=JSON.parse(I);for(E=0;E<k.length;E++){t=q+E*r;u=r-q;if(I.x>=t&&I.x<=t+u){B=k[E];s=q+z-(F*(B-C));if(B==0){if(C>=0||D>0){s-=1}G=1}else{G=F*k[E]}H=s+(G<0?G:0);p=G<0?-G:G;if(I.y>=H&&I.y<=H+p){m.strokeStyle=v.focusColour;m.lineWidth=j;m.strokeRect(t-j/2,H-j/2,u+j,p+j);m.fillStyle=v.fontColour;m.font=v.fontStyle;if(I.x>o.width/2){m.textAlign="right"}if(I.y<o.height/2){m.textBaseline="top";I.y+=20}m.fillText(B+"",I.x,I.y)}}}}o.addEventListener("mousemove",function n(h){this.removeEventListener("mousemove",n,false);var i=o.getBoundingClientRect();var w={x:h.clientX-i.left,y:h.clientY-i.top};l.data("position",JSON.stringify(w)).change()},false)})})(jQuery,document,window.devicePixelRatio||1);
