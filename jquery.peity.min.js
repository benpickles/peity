// Peity jQuery plugin version 1.2.0
// (c) 2013 Ben Pickles
//
// http://benpickles.github.io/peity
//
// Released under MIT license.
(function(f,b,d,a){var g=b.createElement("canvas").getContext;var e=f.fn.peity=function(j,i){if(g){this.each(function(){var o=f(this);var k=o.data("peity");if(k){if(j){k.type=j}f.extend(k.opts,i);k.draw()}else{var n=e.defaults[j];var m={};f.each(o.data(),function(p,q){if(p in n){m[p]=q}});var l=f.extend({},n,m,i);var k=new h(o,j,l);k.draw();o.change(function(q,p,r){k.draw()}).data("peity",k)}})}return this};var h=function(i,j,k){this.$el=i;this.type=j;this.opts=k};var c=h.prototype;c.colours=function(){var j=this.opts.colours;var i=j;if(!f.isFunction(i)){i=function(k,l){return j[l%j.length]}}return i};c.draw=function(){e.graphers[this.type].call(this,this.opts)};c.prepareCanvas=function(k,i){var j=this.canvas;var l;if(j){this.context.clearRect(0,0,j.width,j.height);l=f(j)}else{l=f("<canvas>").css({height:i,width:k}).addClass("peity").data("peity",this);this.canvas=j=l[0];this.context=j.getContext("2d");this.$el.hide().after(j)}j.height=l.height()*a;j.width=l.width()*a;return j};c.values=function(){return f.map(this.$el.text().split(this.opts.delimiter),function(i){return parseFloat(i)})};e.defaults={};e.graphers={};e.register=function(i,j,k){this.defaults[i]=j;this.graphers[i]=k};e.register("pie",{colours:["#ff9900","#fff4dd","#ffc66e"],delimiter:null,diameter:16},function(j){if(!j.delimiter){var k=this.$el.text().match(/[^0-9\.]/);j.delimiter=k?k[0]:","}var y=this.values();if(j.delimiter=="/"){var x=y[0];var u=y[1];y=[x,u-x]}var q=0;var o=y.length;var t=0;for(;q<o;q++){t+=y[q]}var n=this.prepareCanvas(j.width||j.diameter,j.height||j.diameter);var m=this.context;var l=n.width;var z=n.height;var s=d.min(l,z)/2;var r=d.PI;var p=this.colours();m.save();m.translate(l/2,z/2);m.rotate(-r/2);for(q=0;q<o;q++){var w=y[q];var v=(w/t)*r*2;m.beginPath();m.moveTo(0,0);m.arc(0,0,s,0,v,false);m.fillStyle=p.call(this,w,q,y);m.fill();m.rotate(v)}m.restore()});e.register("line",{colour:"#c6d9fd",strokeColour:"#4d89f9",strokeWidth:1,delimiter:",",height:16,max:null,min:0,width:32},function(k){var v=this.values();if(v.length==1){v.push(v[0])}var s=d.max.apply(d,v.concat([k.max]));var o=d.min.apply(d,v.concat([k.min]));var n=this.prepareCanvas(k.width,k.height);var m=this.context;var l=n.width;var w=n.height;var j=l/(v.length-1);var q=w/(s-o);var u=[];var p;m.beginPath();m.moveTo(0,w+(o*q));for(p=0;p<v.length;p++){var t=p*j;var r=w-(q*(v[p]-o));u.push({x:t,y:r});m.lineTo(t,r)}m.lineTo(l,w+(o*q));m.fillStyle=k.colour;m.fill();if(k.strokeWidth){m.beginPath();m.moveTo(0,u[0].y);for(p=0;p<u.length;p++){m.lineTo(u[p].x,u[p].y)}m.lineWidth=k.strokeWidth*a;m.strokeStyle=k.strokeColour;m.stroke()}});e.register("bar",{baselineHeight:1,baselineColour:"#000000",fontColour:"#000000",fontStyle:"12pt Arial, sans-serif",outlineWidth:0,outlineColour:"#000",colours:["#4D89F9"],delimiter:",",height:16,max:null,min:0,spacing:a,width:32},function(t){var C,r,q,E,s,z,F,n;var j=this.values();var B=d.max.apply(d,j.concat([t.max]));var A=d.min.apply(d,j.concat([t.min]));var k=this.$el;var H=k.data("position");var m=this.prepareCanvas(t.width,t.height);var l=this.context;var o=t.spacing;var J=this.colours();var G=t.outlineWidth;var v=m.width-o*2;var u=m.height-o*2;if(t.baselineHeight){u-=1}var D=u/(B-A);var p=(v+o)/j.length;var I=D*B+o;l.fillStyle=t.baselineColour;l.fillRect(0,I-(t.baselineHeight/2),m.width,t.baselineHeight);for(C=0;C<j.length;C++){r=o+C*p;s=p-o;z=j[C];q=o+u-(D*(z-A));if(z==0){if(A>=0||B>0){q-=1}E=1}else{E=D*j[C]}l.fillStyle=J.call(this,z,C,j);l.fillRect(r,q,s,E)}if(G>0&&H){H=JSON.parse(H);for(C=0;C<j.length;C++){r=o+C*p;s=p-o;if(H.x>=r&&H.x<=r+s){z=j[C];q=o+u-(D*(z-A));if(z==0){if(A>=0||B>0){q-=1}E=1}else{E=D*j[C]}F=q+(E<0?E:0);n=E<0?-E:E;if(H.y>=F&&H.y<=F+n){l.strokeStyle=t.outlineColour;l.lineWidth=G;l.strokeRect(r-G/2,F-G/2,s+G,n+G);l.fillStyle=t.fontColour;l.font=t.fontStyle;if(H.x>m.width/2){l.textAlign="right"}if(H.y<m.height/2){l.textBaseline="top";H.y+=20}l.fillText(z,H.x,H.y)}}}}m.addEventListener("mousemove",function(i){this.removeEventListener("mousemove",arguments.callee,false);var w=m.getBoundingClientRect();var x={x:i.clientX-w.left,y:i.clientY-w.top};k.data("position",JSON.stringify(x)).change()},false)})})(jQuery,document,Math,window.devicePixelRatio||1);
