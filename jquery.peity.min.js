// Peity jQuery plugin version 1.2.1
// (c) 2013 Ben Pickles
//
// http://benpickles.github.io/peity
//
// Released under MIT license.
(function(u,r){var z=document.createElement("canvas").getContext,t=u.fn.peity=function(a,b){z&&this.each(function(){var c=u(this),e=c.data("peity");if(e)a&&(e.type=a),u.extend(e.opt,b),e.draw();else{var n=t.defaults[a],f={};u.each(c.data(),function(a,b){a in n&&(f[a]=b)});var g=u.extend({},n,f,b),e=new x(c,a,g);e.draw();c.change(function(a,b,c){e.draw()}).data("peity",e)}});return this},x=function(a,b,c){this.$el=a;this.type=b;this.opt=c},d=x.prototype;d.fill=function(){var a=this.opt.fill;return u.isFunction(a)?
a:function(b,c){return a[c%a.length]}};d.draw=function(){t.graphers[this.type].call(this,this.opt)};d.prepareCanvas=function(a,b){var c=this.canvas,e;c?c.width=c.width:(e=u("<canvas>").css({height:b,width:a}).addClass("peity").data("peity",this),this.canvas=c=e[0],this.context=c.getContext("2d"),this.$el.hide().after(c),c.height=e.height(),c.width=e.width());return c};d.hoverEvent=function(a){var b=u(this),c=b.offset();d.removeEvents(this);b.prev().data("mouse",JSON.stringify({x:a.clientX-c.left,
y:a.clientY-c.top})).change()};d.exitEvent=function(a){d.removeEvents(this);u(this).prev().removeData("mouse").change()};d.removeEvents=function(a){a.removeEventListener("mouseout",a.exitEvent,!1);a.removeEventListener("mousemove",a.hoverEvent,!1)};d.addEvents=function(a){a.addEventListener("mousemove",d.hoverEvent,!1);a.addEventListener("mouseout",d.exitEvent,!1)};d.values=function(){var a=this.opt.delimiter,b=this.opt.seriesDelimiter,c=this.$el.text(),e=function(b){return b.split(a).map(function(a){return parseFloat(a)})};
return b?c.split(b).map(e):e(c)};d.setLineStyle=function(a,b,c){a.lineWidth=c;a.strokeStyle=b};d.drawArc=function(a,b,c,e,n,f){a.beginPath();a.arc(0,0,b,c,e,!0);d.setLineStyle(a,n,f);a.stroke()};t.defaults={};t.graphers={};t.register=function(a,b,c){this.defaults[a]=b;this.graphers[a]=c};t.register("pie",{fill:["#f90","#ffd","#fc6"],delimiter:null,diameter:16,lineColor:"#000",lineWidth:0,focusColor:"#000",focusWidth:0},function(a){if(!a.delimiter){var b=this.$el.text().match(/[^0-9\.]/);a.delimiter=
b?b[0]:","}b=this.values();"/"===a.delimiter&&(b=[b[0],b[1]-b[0]]);var c,e=0,n=b.length;for(c=0;c<n;c++)e+=b[c];var f=this.$el.data("mouse"),g=a.focusWidth,h=a.lineWidth,l=r.max(g,h)+1,p=a.diameter,p=this.prepareCanvas(p+l,p+l),m=this.context;c=p.width;var k=p.height,l=c/2-l,q=2*r.PI,e=q/e,A=this.fill();if(g&&f){f=JSON.parse(f);f.x-=c/2;f.y-=k/2;f.y*=-1;f.r=r.sqrt(f.x*f.x+f.y*f.y);for(f.a=r.atan2(f.y,f.x);0>f.a;)f.a+=q;for(;f.a>q;)f.a-=q}m.translate(c/2,k/2);var s,d=0;for(c=0;c<n;c++)k=b[c],s=k*e,
m.beginPath(),m.moveTo(0,0),m.arc(0,0,l,-d,-(d+s),!0),m.fillStyle=A.call(this,k,c,b),m.fill(),g&&f&&f.a>d&&f.a<d+s&&this.drawArc(m,l+g/2,-d,-(d+s),a.focusColor,g),d+=s;h&&this.drawArc(m,l+h/2,0,q,a.lineColor,h);g&&this.addEvents(p)});t.register("line",{fill:"#cdf",lineColor:"#48f",lineWidth:1,delimiter:",",height:16,width:32,max:null,min:0},function(a){var b=this.values();1==b.length&&b.push(b[0]);var c=r.max.apply(r,b.concat([a.max])),e=r.min.apply(r,b.concat([a.min])),n=a.lineWidth,f=this.prepareCanvas(a.width,
a.height),g=this.context,h=f.width,f=f.height-n,l=h/(b.length-1),c=f/(c-e),p=[],m;g.beginPath();g.moveTo(0,f+e*c);for(m=0;m<b.length;m++){var k=m*l,q=f-c*(b[m]-e)+n/2;p.push({x:k,y:q});g.lineTo(k,q)}g.lineTo(h,f+e*c);a.fill&&(g.fillStyle=a.fill,g.fill());if(n){g.beginPath();g.moveTo(0,p[0].y);for(m=0;m<p.length;m++)g.lineTo(p[m].x,p[m].y);this.setLineStyle(g,a.lineColor,n);g.stroke()}});t.register("lines",{lineColors:["#666666","#803E75"],lineWidths:[1],delimiter:",",seriesDelimiter:"|",height:16,
max:null,min:0,width:32,pointSize:2,gridlines:[1,1],gridlineColors:["#000","#bbb"]},function(a){var b=this.values(),c=a.pointSize,e=[].concat.apply([a.max,a.min],b),n=r.max.apply(r,e),e=r.min.apply(r,e),f=a.region||(n-e)/5,g=this.prepareCanvas(a.width,a.height),h=this.context,l=g.width-2*c,g=g.height,p=l/(b[0].length-1),m=g/(n-e),k=a.lineColors,q=a.lineWidths,d=a.gridlines,s=a.gridlineColors;d[0]&&(h.beginPath(),h.moveTo(0,g-m*(0-e)),h.lineTo(l+2*c,g-m*(0-e)),this.setLineStyle(h,s[0],d[0]),h.stroke());
if(d[1])for(this.setLineStyle(h,s[1],d[1]),d=e;d<=n;d+=f)h.beginPath(),h.moveTo(0,g-m*(d-e)),h.lineTo(l+2*c,g-m*(d-e)),h.stroke();for(d=0;d<b.length;d+=1){f=b[d];l=[];for(n=0;n<f.length;n++)l.push({x:n*p+c,y:g-m*(f[n]-e)}),h.beginPath(),h.arc(l[n].x,l[n].y,a.pointSize,0,2*r.PI,!1),h.fillStyle=k[d%k.length],h.fill();h.beginPath();h.moveTo(0,l[0].y);for(n=0;n<l.length;n++)h.lineTo(l[n].x,l[n].y);this.setLineStyle(h,k[d%k.length],q[d%q.length]);h.stroke()}});t.register("bar",{fill:["#48f"],fontColor:"#000",
font:"12pt sans-serif",focusColor:"#000",focusWidth:0,height:16,width:32,max:null,min:0,delimiter:",",gap:1,gridlines:[1,1],gridlineColors:["#000","#bbb"]},function(a){var b,c,e,d,f,g,h=this.values();c=r.max.apply(r,h.concat([a.max]));var l=r.min.apply(r,h.concat([a.min]));e=a.region||(c-l)/5;var p=this.$el.data("mouse"),m=this.prepareCanvas(a.width,a.height),k=this.context,q=a.gap,u=this.fill(),s=a.focusWidth;b=a.gridlines;d=a.gridlineColors;var t=m.width,x=m.height,w=x-2*q-b[0],v=w/(c-l),y=(t-2*
q+q)/h.length;b[0]&&(k.beginPath(),k.moveTo(0,w-v*(0-l)+q),k.lineTo(t,w-v*(0-l)+q),this.setLineStyle(k,d[0],b[0]),k.stroke());if(b[1])for(this.setLineStyle(k,d[1],b[1]),b=l;b<=c;b+=e)k.beginPath(),k.moveTo(0,w-v*(b-l)+q),k.lineTo(t,w-v*(b-l)+q),k.stroke();for(b=0;b<h.length;b++)g=h[b],c=q+b*y,f=y-q,e=q+w-v*(g-l),d=v*g,k.fillStyle=u.call(this,g,b,h),k.fillRect(c,e,f,d);if(s&&p)for(p=JSON.parse(p),b=0;b<h.length;b++)if(c=q+b*y,f=y-q,p.x>=c&&p.x<=c+f){g=h[b];e=q+w-v*(g-l);d=0===g?1:v*h[b];e+=r.min(d,
0);d=r.abs(d);p.y>=e&&p.y<=e+d&&(this.setLineStyle(k,a.focusColor,s),k.strokeRect(c-s/2,e-s/2,f+s,d+s),k.fillStyle=a.fontColor,k.font=a.font,p.x>t/2&&(k.textAlign="right"),p.y<x/2&&(k.textBaseline="top",p.y+=20),k.fillText(g+"",p.x,p.y));break}s&&this.addEvents(m)})})(jQuery,Math);
