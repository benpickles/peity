// Peity jQuery plugin version 1.2.1
// (c) 2013 Ben Pickles
//
// http://benpickles.github.io/peity
//
// Released under MIT license.
(function(u,p){var z=document.createElement("canvas").getContext,s=u.fn.peity=function(a,c){z&&this.each(function(){var b=u(this),e=b.data("peity");if(e)a&&(e.type=a),u.extend(e.opt,c),e.draw();else{var k=s.defaults[a],d={};u.each(b.data(),function(a,b){a in k&&(d[a]=b)});var f=u.extend({},k,d,c),e=new y(b,a,f);e.draw();b.change(function(a,b,c){e.draw()}).data("peity",e)}});return this},y=function(a,c,b){this.$el=a;this.type=c;this.opt=b},r=y.prototype;r.fill=function(){var a=this.opt.fill;return u.isFunction(a)?
a:function(c,b){return a[b%a.length]}};r.draw=function(){s.graphers[this.type].call(this,this.opt)};r.prepareCanvas=function(a,c){var b=this.canvas,e;b?b.width=b.width:(e=u("<canvas>").css({height:c,width:a}).addClass("peity").data("peity",this),this.canvas=b=e[0],this.context=b.getContext("2d"),this.$el.hide().after(b),b.height=e.height(),b.width=e.width());return b};r.hoverEvent=function(a){r.removeEvents(this);var c=this.getBoundingClientRect();u(this).prev().data("mouse",JSON.stringify({x:a.clientX-
c.left,y:a.clientY-c.top})).change()};r.exitEvent=function(a){r.removeEvents(this);u(this).prev().removeData("mouse").change()};r.removeEvents=function(a){a.removeEventListener("mouseout",a.exitEvent,!1);a.removeEventListener("mousemove",a.hoverEvent,!1)};r.addEvents=function(a){a.addEventListener("mousemove",r.hoverEvent,!1);a.addEventListener("mouseout",r.exitEvent,!1)};r.values=function(){var a=this.opt.delimiter,c=this.opt.seriesDelimiter,b=this.$el.text(),e=function(b){return b.split(a).map(function(a){return parseFloat(a)})};
return c?b.split(c).map(e):e(b)};r.drawArc=function(a,c,b,e,k,d){a.beginPath();a.arc(0,0,c,b,e,!0);a.strokeStyle=k;a.lineWidth=d;a.stroke()};s.defaults={};s.graphers={};s.register=function(a,c,b){this.defaults[a]=c;this.graphers[a]=b};s.register("pie",{fill:["#f90","#ffd","#fc6"],delimiter:null,diameter:16,lineColor:"#000",lineWidth:0,focusColor:"#000",focusWidth:0},function(a){if(!a.delimiter){var c=this.$el.text().match(/[^0-9\.]/);a.delimiter=c?c[0]:","}c=this.values();"/"===a.delimiter&&(c=[c[0],
c[1]-c[0]]);var b,e=0,k=c.length;for(b=0;b<k;b++)e+=c[b];var d=this.$el.data("mouse"),f=a.focusWidth,m=a.lineWidth,q=p.max(f,m)+1,h=a.diameter,h=this.prepareCanvas(h+q,h+q),g=this.context;b=h.width;var l=h.height,q=b/2-q,n=2*p.PI,e=n/e,r=this.fill();if(f&&d){d=JSON.parse(d);d.x-=b/2;d.y-=l/2;d.y*=-1;d.r=p.sqrt(d.x*d.x+d.y*d.y);for(d.a=p.atan2(d.y,d.x);0>d.a;)d.a+=n;for(;d.a>n;)d.a-=n}g.translate(b/2,l/2);var t,v=0;for(b=0;b<k;b++)l=c[b],t=l*e,g.beginPath(),g.moveTo(0,0),g.arc(0,0,q,-v,-(v+t),!0),
g.fillStyle=r.call(this,l,b,c),g.fill(),f&&d&&d.a>v&&d.a<v+t&&this.drawArc(g,q+f/2,-v,-(v+t),a.focusColor,f),v+=t;m&&this.drawArc(g,q+m/2,0,n,a.lineColor,m);f&&this.addEvents(h)});s.register("line",{fill:"#cdf",lineColor:"#48f",lineWidth:1,delimiter:",",height:16,width:32,max:null,min:0},function(a){var c=this.values();1==c.length&&c.push(c[0]);var b=p.max.apply(p,c.concat([a.max])),e=p.min.apply(p,c.concat([a.min])),k=a.lineWidth,d=this.prepareCanvas(a.width,a.height),f=this.context,m=d.width,d=
d.height-k,q=m/(c.length-1),b=d/(b-e),h=[],g;f.beginPath();f.moveTo(0,d+e*b);for(g=0;g<c.length;g++){var l=g*q,n=d-b*(c[g]-e)+k/2;h.push({x:l,y:n});f.lineTo(l,n)}f.lineTo(m,d+e*b);a.fill&&(f.fillStyle=a.fill,f.fill());if(k){f.beginPath();f.moveTo(0,h[0].y);for(g=0;g<h.length;g++)f.lineTo(h[g].x,h[g].y);f.lineWidth=k;f.strokeStyle=a.lineColor;f.stroke()}});s.register("lines",{fill:["#666666","#803E75","#FF6800"],lineColor:"#4d89f9",lineWidth:1,delimiter:",",seriesDelimiter:"|",height:16,max:null,min:0,
width:32},function(a){var c=this.values(),b=[a.max,a.min].concat.apply([],c),e=p.max.apply(p,b),b=p.min.apply(p,b),k=this.prepareCanvas(a.width,a.height),d=this.context,f=k.width,k=k.height,m=f/(c[1].length-1),e=k/(e-b),q=a.fill,h,g;d.lineWidth=a.lineWidth;g=[{x:0,y:k-e*(0-b)},{x:f,y:k-e*(0-b)}];d.beginPath();d.moveTo(0,g[0].y);for(a=0;a<g.length;a++)d.lineTo(g[a].x,g[a].y);d.strokeStyle=q[0%q.length];d.stroke();for(f=0;f<c.length;f+=1){h=c[f];g=[];for(a=0;a<h.length;a++)g.push({x:a*m,y:k-e*(h[a]-
b)});d.beginPath();d.moveTo(0,g[0].y);for(a=0;a<g.length;a++)d.lineTo(g[a].x,g[a].y);d.strokeStyle=q[(f+1)%q.length];d.stroke()}});s.register("bar",{fill:["#48f"],axisColor:"#000",axisSize:1,fontColor:"#000",font:"12pt sans-serif",focusColor:"#000",focusWidth:0,height:16,width:32,max:null,min:0,delimiter:",",gap:1},function(a){var c,b,e,k,d,f,m=this.values();b=p.max.apply(p,m.concat([a.max]));var q=p.min.apply(p,m.concat([a.min])),h=this.$el.data("mouse"),g=this.prepareCanvas(a.width,a.height),l=
this.context,n=a.gap,r=this.fill(),t=a.focusWidth;c=a.axisSize;var v=g.width,u=g.height,s=u-2*n-c,w=s/(b-q),x=(v-2*n+n)/m.length;b=w*b+n;c&&(l.fillStyle=a.axisColor,l.fillRect(0,b-c/2,v,c));for(c=0;c<m.length;c++)f=m[c],b=n+c*x,d=x-n,e=n+s-w*(f-q),k=w*f,l.fillStyle=r.call(this,f,c,m),l.fillRect(b,e,d,k);if(t&&h)for(h=JSON.parse(h),c=0;c<m.length;c++)if(b=n+c*x,d=x-n,h.x>=b&&h.x<=b+d){f=m[c];e=n+s-w*(f-q);k=0===f?1:w*m[c];e+=p.min(k,0);k=p.abs(k);h.y>=e&&h.y<=e+k&&(l.strokeStyle=a.focusColor,l.lineWidth=
t,l.strokeRect(b-t/2,e-t/2,d+t,k+t),l.fillStyle=a.fontColor,l.font=a.font,h.x>v/2&&(l.textAlign="right"),h.y<u/2&&(l.textBaseline="top",h.y+=20),l.fillText(f+"",h.x,h.y));break}t&&this.addEvents(g)})})(jQuery,Math);
