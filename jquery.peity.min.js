// Peity jQuery plugin version 1.2.1
// (c) 2013 Ben Pickles
//
// http://benpickles.github.io/peity
//
// Released under MIT license.
(function(x,s){var A=document.createElement("canvas").getContext,v=x.fn.peity=function(a,c){A&&this.each(function(){var b=x(this),d=b.data("peity");if(d)a&&(d.type=a),x.extend(d.opt,c),d.draw();else{var l=v.defaults[a],e={};x.each(b.data(),function(a,b){a in l&&(e[a]=b)});var g=x.extend({},l,e,c),d=new z(b,a,g);d.draw();b.change(function(a,b,c){d.draw()}).data("peity",d)}});return this},z=function(a,c,b){this.$el=a;this.type=c;this.opt=b},p=z.prototype;p.fill=function(){var a=this.opt.fill;return x.isFunction(a)?
a:function(c,b){return a[b%a.length]}};p.draw=function(){v.graphers[this.type].call(this,this.opt)};p.prepareCanvas=function(a,c){var b=this.canvas,d;b?b.width=b.width:(d=x("<canvas>").css({height:c,width:a}).addClass("peity").data("peity",this),this.canvas=b=d[0],this.context=b.getContext("2d"),this.$el.hide().after(b),b.height=d.height(),b.width=d.width());return b};p.hoverEvent=function(a){p.removeEvents(this);var c=this.getBoundingClientRect();x(this).prev().data("mouse",JSON.stringify({x:a.clientX-
c.left,y:a.clientY-c.top})).change()};p.exitEvent=function(a){p.removeEvents(this);x(this).prev().removeData("mouse").change()};p.removeEvents=function(a){a.removeEventListener("mouseout",a.exitEvent,!1);a.removeEventListener("mousemove",a.hoverEvent,!1)};p.addEvents=function(a){a.addEventListener("mousemove",p.hoverEvent,!1);a.addEventListener("mouseout",p.exitEvent,!1)};p.values=function(){var a=this.opt.delimiter,c=this.opt.seriesDelimiter,b=this.$el.text(),d=function(b){return b.split(a).map(function(a){return parseFloat(a)})};
return c?b.split(c).map(d):d(b)};p.drawArc=function(a,c,b,d,l,e){a.beginPath();a.arc(0,0,c,b,d,!0);a.strokeStyle=l;a.lineWidth=e;a.stroke()};v.defaults={};v.graphers={};v.register=function(a,c,b){this.defaults[a]=c;this.graphers[a]=b};v.register("pie",{fill:["#f90","#ffd","#fc6"],delimiter:null,diameter:16,lineColor:"#000",lineWidth:0,focusColor:"#000",focusWidth:0},function(a){if(!a.delimiter){var c=this.$el.text().match(/[^0-9\.]/);a.delimiter=c?c[0]:","}c=this.values();"/"===a.delimiter&&(c=[c[0],
c[1]-c[0]]);var b,d=0,l=c.length;for(b=0;b<l;b++)d+=c[b];var e=this.$el.data("mouse"),g=a.focusWidth,f=a.lineWidth,w=s.max(g,f)+1,m=a.diameter,m=this.prepareCanvas(m+w,m+w),k=this.context;b=m.width;var n=m.height,w=b/2-w,q=2*s.PI,d=q/d,p=this.fill();if(g&&e){e=JSON.parse(e);e.x-=b/2;e.y-=n/2;e.y*=-1;e.r=s.sqrt(e.x*e.x+e.y*e.y);for(e.a=s.atan2(e.y,e.x);0>e.a;)e.a+=q;for(;e.a>q;)e.a-=q}k.translate(b/2,n/2);var u,h=0;for(b=0;b<l;b++)n=c[b],u=n*d,k.beginPath(),k.moveTo(0,0),k.arc(0,0,w,-h,-(h+u),!0),
k.fillStyle=p.call(this,n,b,c),k.fill(),g&&e&&e.a>h&&e.a<h+u&&this.drawArc(k,w+g/2,-h,-(h+u),a.focusColor,g),h+=u;f&&this.drawArc(k,w+f/2,0,q,a.lineColor,f);g&&this.addEvents(m)});v.register("line",{fill:"#cdf",lineColor:"#48f",lineWidth:1,delimiter:",",height:16,width:32,max:null,min:0},function(a){var c=this.values();1==c.length&&c.push(c[0]);var b=s.max.apply(s,c.concat([a.max])),d=s.min.apply(s,c.concat([a.min])),l=a.lineWidth,e=this.prepareCanvas(a.width,a.height),g=this.context,f=e.width,e=
e.height-l,w=f/(c.length-1),b=e/(b-d),m=[],k;g.beginPath();g.moveTo(0,e+d*b);for(k=0;k<c.length;k++){var n=k*w,q=e-b*(c[k]-d)+l/2;m.push({x:n,y:q});g.lineTo(n,q)}g.lineTo(f,e+d*b);a.fill&&(g.fillStyle=a.fill,g.fill());if(l){g.beginPath();g.moveTo(0,m[0].y);for(k=0;k<m.length;k++)g.lineTo(m[k].x,m[k].y);g.lineWidth=l;g.strokeStyle=a.lineColor;g.stroke()}});v.register("lines",{lineColors:["#666666","#803E75"],lineWidths:[1],delimiter:",",seriesDelimiter:"|",height:16,max:null,min:0,width:32,pointSize:2,
gridlines:[1,1],gridlineColors:["#000","#bbb"]},function(a){var c=this.values(),b=a.pointSize,d=[].concat.apply([a.max,a.min],c),l=s.max.apply(s,d),d=s.min.apply(s,d),e=a.region||(l-d)/5,g=this.prepareCanvas(a.width,a.height),f=this.context,w=g.width-2*b,g=g.height,m=w/(c[0].length-1),k=g/(l-d),n=a.lineColors,q=a.lineWidths,p=a.gridlines,u=a.gridlineColors,h,t,r;if(p[0]){r=[{x:0,y:g-k*(0-d)},{x:w+2*b,y:g-k*(0-d)}];f.beginPath();f.moveTo(0,r[0].y);for(h=0;h<r.length;h++)f.lineTo(r[h].x,r[h].y);f.lineWidth=
p[0];f.strokeStyle=u[0];f.stroke()}if(p[1])for(t=d;t<=l;t+=e){r=[{x:0,y:g-k*(t-d)},{x:w+2*b,y:g-k*(t-d)}];f.beginPath();f.moveTo(0,r[0].y);for(h=0;h<r.length;h++)f.lineTo(r[h].x,r[h].y);f.lineWidth=p[1];f.strokeStyle=u[1];f.stroke()}for(t=0;t<c.length;t+=1){l=c[t];r=[];for(h=0;h<l.length;h++)r.push({x:h*m+b,y:g-k*(l[h]-d)}),f.beginPath(),f.arc(r[h].x,r[h].y,a.pointSize,0,2*s.PI,!1),f.fillStyle=n[t%n.length],f.fill();f.beginPath();f.moveTo(0,r[0].y);for(h=0;h<r.length;h++)f.lineTo(r[h].x,r[h].y);f.lineWidth=
q[t%q.length];f.strokeStyle=n[t%n.length];f.stroke()}});v.register("bar",{fill:["#48f"],axisColor:"#000",axisSize:1,fontColor:"#000",font:"12pt sans-serif",focusColor:"#000",focusWidth:0,height:16,width:32,max:null,min:0,delimiter:",",gap:1},function(a){var c,b,d,l,e,g,f=this.values();b=s.max.apply(s,f.concat([a.max]));var p=s.min.apply(s,f.concat([a.min])),m=this.$el.data("mouse"),k=this.prepareCanvas(a.width,a.height),n=this.context,q=a.gap,x=this.fill(),u=a.focusWidth;c=a.axisSize;var h=k.width,
t=k.height,r=t-2*q-c,v=r/(b-p),y=(h-2*q+q)/f.length;b=v*b+q;c&&(n.fillStyle=a.axisColor,n.fillRect(0,b-c/2,h,c));for(c=0;c<f.length;c++)g=f[c],b=q+c*y,e=y-q,d=q+r-v*(g-p),l=v*g,n.fillStyle=x.call(this,g,c,f),n.fillRect(b,d,e,l);if(u&&m)for(m=JSON.parse(m),c=0;c<f.length;c++)if(b=q+c*y,e=y-q,m.x>=b&&m.x<=b+e){g=f[c];d=q+r-v*(g-p);l=0===g?1:v*f[c];d+=s.min(l,0);l=s.abs(l);m.y>=d&&m.y<=d+l&&(n.strokeStyle=a.focusColor,n.lineWidth=u,n.strokeRect(b-u/2,d-u/2,e+u,l+u),n.fillStyle=a.fontColor,n.font=a.font,
m.x>h/2&&(n.textAlign="right"),m.y<t/2&&(n.textBaseline="top",m.y+=20),n.fillText(g+"",m.x,m.y));break}u&&this.addEvents(k)})})(jQuery,Math);
