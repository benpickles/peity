// Peity jQuery plugin version 1.2.0
// (c) 2013 Ben Pickles
//
// http://benpickles.github.io/peity
//
// Released under MIT license.
(function(r,w,x){var z=w.createElement("canvas").getContext,s=r.fn.peity=function(a,b){z&&this.each(function(){var d=r(this),c=d.data("peity");if(c)a&&(c.type=a),r.extend(c.opts,b),c.draw();else{var f=s.defaults[a],g={};r.each(d.data(),function(a,b){a in f&&(g[a]=b)});var e=r.extend({},f,g,b),c=new y(d,a,e);c.draw();d.change(function(a,b,d){c.draw()}).data("peity",c)}});return this},y=function(a,b,d){this.$el=a;this.type=b;this.opts=d};w=y.prototype;w.colours=function(){var a=this.opts.colours;return r.isFunction(a)?
a:function(b,d){return a[d%a.length]}};w.draw=function(){s.graphers[this.type].call(this,this.opts)};w.prepareCanvas=function(a,b){var d=this.canvas,c;d?(this.context.clearRect(0,0,d.width,d.height),c=r(d)):(c=r("<canvas>").css({height:b,width:a}).addClass("peity").data("peity",this),this.canvas=d=c[0],this.context=d.getContext("2d"),this.$el.hide().after(d));d.height=c.height()*x;d.width=c.width()*x;return d};w.values=function(){return this.$el.text().split(this.opts.delimiter).map(function(a){return parseFloat(a)})};
s.defaults={};s.graphers={};s.register=function(a,b,d){this.defaults[a]=b;this.graphers[a]=d};s.register("pie",{colours:["#ff9900","#fff4dd","#ffc66e"],delimiter:null,diameter:16,strokeColour:"#000000",strokeWidth:0,fontColour:"#000000",fontStyle:"12pt Arial, sans-serif",focusWidth:0,focusColour:"#000"},function(a){if(!a.delimiter){var b=this.$el.text().match(/[^0-9\.]/);a.delimiter=b?b[0]:","}b=this.values();if("/"==a.delimiter)var d=b[0],b=[d,b[1]-d];var c,f=0,d=b.length;for(c=0;c<d;c++)f+=b[c];
var g=this.$el,e=g.data("position"),q=a.focusWidth,l=a.strokeWidth,h=Math.max(q,l)+1,u=this.prepareCanvas((a.width||a.diameter)+h,(a.height||a.diameter)+h),k=this.context;c=u.width;var m=u.height,h=Math.min(c,m)/2-h,v=2*Math.PI,f=v/f,t=this.colours();if(0<q&&void 0!==e){e=JSON.parse(e);e.x-=c/2;e.y-=m/2;e.y*=-1;e.r=Math.sqrt(e.x*e.x+e.y*e.y);for(e.theta=Math.atan2(e.y,e.x);0>e.theta;)e.theta+=v;for(;e.theta>v;)e.theta-=v}k.translate(c/2,m/2);var n,p=0;for(c=0;c<d;c++)m=b[c],n=m*f,k.beginPath(),k.moveTo(0,
0),k.arc(0,0,h,-p,-(p+n),!0),k.fillStyle=t.call(this,m,c,b),k.fill(),0<q&&e&&e.theta>p&&e.theta<p+n&&(k.beginPath(),k.arc(0,0,h+q/2,-p,-(p+n),!0),k.strokeStyle=a.focusColour,k.lineWidth=q,k.stroke()),p+=n;0<l&&(k.beginPath(),k.arc(0,0,h+l/2,0,v,!0),k.strokeStyle=a.strokeColour,k.lineWidth=l,k.stroke());0<q&&u.addEventListener("mousemove",function A(a){this.removeEventListener("mousemove",A,!1);var b=u.getBoundingClientRect();g.data("position",JSON.stringify({x:a.clientX-b.left,y:a.clientY-b.top})).change()},
!1)});s.register("line",{colour:"#c6d9fd",strokeColour:"#4d89f9",strokeWidth:1,delimiter:",",height:16,max:null,min:0,width:32},function(a){var b=this.values();1==b.length&&b.push(b[0]);var d=Math.max.apply(Math,b.concat([a.max])),c=Math.min.apply(Math,b.concat([a.min])),f=this.prepareCanvas(a.width,a.height),g=this.context,e=f.width,f=f.height,q=e/(b.length-1),d=f/(d-c),l=[],h;g.beginPath();g.moveTo(0,f+c*d);for(h=0;h<b.length;h++){var u=h*q,k=f-d*(b[h]-c);l.push({x:u,y:k});g.lineTo(u,k)}g.lineTo(e,
f+c*d);g.fillStyle=a.colour;g.fill();if(a.strokeWidth){g.beginPath();g.moveTo(0,l[0].y);for(h=0;h<l.length;h++)g.lineTo(l[h].x,l[h].y);g.lineWidth=a.strokeWidth*x;g.strokeStyle=a.strokeColour;g.stroke()}});s.register("bar",{baselineHeight:1,baselineColour:"#000000",fontColour:"#000000",fontStyle:"12pt Arial, sans-serif",focusWidth:0,focusColour:"#000",colours:["#4D89F9"],delimiter:",",height:16,max:null,min:0,spacing:1,width:32},function(a){var b,d,c,f,g,e,q,l=this.values(),h=Math.max.apply(Math,
l.concat([a.max])),u=Math.min.apply(Math,l.concat([a.min])),k=this.$el,m=k.data("position"),v=this.prepareCanvas(a.width,a.height),t=this.context,n=a.spacing;q=this.colours();var p=a.focusWidth;b=v.width-2*n;var r=v.height-2*n;a.baselineHeight&&(r-=1);var s=r/(h-u),w=(b+n)/l.length;t.fillStyle=a.baselineColour;t.fillRect(0,s*h+n-a.baselineHeight/2,v.width,a.baselineHeight);for(b=0;b<l.length;b++){d=n+b*w;g=w-n;e=l[b];c=n+r-s*(e-u);if(0==e){if(0<=u||0<h)c-=1;f=1}else f=s*l[b];t.fillStyle=q.call(this,
e,b,l);t.fillRect(d,c,g,f)}if(0<p&&m)for(m=JSON.parse(m),b=0;b<l.length;b++)if(d=n+b*w,g=w-n,m.x>=d&&m.x<=d+g){e=l[b];c=n+r-s*(e-u);if(0==e){if(0<=u||0<h)c-=1;f=1}else f=s*l[b];q=c+(0>f?f:0);f=0>f?-f:f;m.y>=q&&m.y<=q+f&&(t.strokeStyle=a.focusColour,t.lineWidth=p,t.strokeRect(d-p/2,q-p/2,g+p,f+p),t.fillStyle=a.fontColour,t.font=a.fontStyle,m.x>v.width/2&&(t.textAlign="right"),m.y<v.height/2&&(t.textBaseline="top",m.y+=20),t.fillText(e+"",m.x,m.y))}0<p&&v.addEventListener("mousemove",function B(a){this.removeEventListener("mousemove",
B,!1);var b=v.getBoundingClientRect();k.data("position",JSON.stringify({x:a.clientX-b.left,y:a.clientY-b.top})).change()},!1)})})(jQuery,document,window.devicePixelRatio||1);
