(function(n,y,w){var z=y.createElement("canvas").getContext,r=n.fn.peity=function(a,c){z&&this.each(function(){var d=n(this),e=d.data("peity");if(e)a&&(e.type=a),n.extend(e.opts,c),e.draw();else{var f=r.defaults[a],b={};n.each(d.data(),function(a,c){a in f&&(b[a]=c)});var g=n.extend({},f,b,c),e=new x(d,a,g);e.draw();d.change(function(a,b,c){e.draw()}).data("peity",e)}});return this},x=function(a,c,d){this.$el=a;this.type=c;this.opts=d},v=x.prototype;v.colours=function(){var a=this.opts.colours;return n.isFunction(a)?
a:function(c,d){return a[d%a.length]}};v.draw=function(){r.graphers[this.type].call(this,this.opts)};v.prepareCanvas=function(a,c){var d=this.canvas,e;d?(this.context.clearRect(0,0,d.width,d.height),e=n(d)):(e=n("<canvas>").css({height:c,width:a}).addClass("peity").data("peity",this),this.canvas=d=e[0],this.context=d.getContext("2d"),this.$el.hide().after(d));d.height=e.height()*w;d.width=e.width()*w;return d};v.hoverEvent=function(a){this.removeEventListener("mouseout",this.exitEvent,!1);this.removeEventListener("mousemove",
this.hoverEvent,!1);var c=this.getBoundingClientRect();a={x:a.clientX-c.left,y:a.clientY-c.top};n(this.previousSibling).data("position",JSON.stringify(a)).change()};v.exitEvent=function(a){this.removeEventListener("mouseout",this.exitEvent,!1);this.removeEventListener("mousemove",this.hoverEvent,!1);n(this.previousSibling).removeData("position").change()};v.values=function(){var a=this.opts.delimiter;return this.opts.seriesDelimiter?this.$el.text().split(this.opts.seriesDelimiter).map(function(c){return c.split(a).map(function(a){return parseFloat(a)})}):
this.$el.text().split(this.opts.delimiter).map(function(a){return parseFloat(a)})};r.defaults={};r.graphers={};r.register=function(a,c,d){this.defaults[a]=c;this.graphers[a]=d};r.register("pie",{colours:["#ff9900","#fff4dd","#ffc66e"],delimiter:null,diameter:16,strokeColour:"#000000",strokeWidth:0,fontColour:"#000000",fontStyle:"12pt Arial, sans-serif",focusWidth:0,focusColour:"#000"},function(a){if(!a.delimiter){var c=this.$el.text().match(/[^0-9\.]/);a.delimiter=c?c[0]:","}c=this.values();if("/"==
a.delimiter)var d=c[0],c=[d,c[1]-d];var e,f=0,d=c.length;for(e=0;e<d;e++)f+=c[e];var b=this.$el.data("position"),g=a.focusWidth,s=a.strokeWidth,k=Math.max(g,s)+1,l=this.prepareCanvas((a.width||a.diameter)+k,(a.height||a.diameter)+k),h=this.context;e=l.width;var m=l.height,k=Math.min(e,m)/2-k,u=2*Math.PI,f=u/f,t=this.colours();if(0<g&&void 0!==b){b=JSON.parse(b);b.x-=e/2;b.y-=m/2;b.y*=-1;b.r=Math.sqrt(b.x*b.x+b.y*b.y);for(b.theta=Math.atan2(b.y,b.x);0>b.theta;)b.theta+=u;for(;b.theta>u;)b.theta-=u}h.translate(e/
2,m/2);var p,q=0;for(e=0;e<d;e++)m=c[e],p=m*f,h.beginPath(),h.moveTo(0,0),h.arc(0,0,k,-q,-(q+p),!0),h.fillStyle=t.call(this,m,e,c),h.fill(),0<g&&b&&b.theta>q&&b.theta<q+p&&(h.beginPath(),h.arc(0,0,k+g/2,-q,-(q+p),!0),h.strokeStyle=a.focusColour,h.lineWidth=g,h.stroke()),q+=p;0<s&&(h.beginPath(),h.arc(0,0,k+s/2,0,u,!0),h.strokeStyle=a.strokeColour,h.lineWidth=s,h.stroke());0<g&&(l.addEventListener("mousemove",v.hoverEvent,!1),l.addEventListener("mouseout",v.exitEvent,!1))});r.register("line",{colour:"#c6d9fd",
strokeColour:"#4d89f9",strokeWidth:1,delimiter:",",height:16,max:null,min:0,width:32,fill:!0},function(a){var c=this.values();1==c.length&&c.push(c[0]);var d=Math.max.apply(Math,c.concat([a.max])),e=Math.min.apply(Math,c.concat([a.min])),f=this.prepareCanvas(a.width,a.height),b=this.context,g=f.width,f=f.height,s=g/(c.length-1),d=f/(d-e),k=[],l;b.beginPath();b.moveTo(0,f+e*d);for(l=0;l<c.length;l++){var h=l*s,m=f-d*(c[l]-e);k.push({x:h,y:m});b.lineTo(h,m)}b.lineTo(g,f+e*d);a.fill&&(b.fillStyle=a.colour,
b.fill());if(a.strokeWidth){b.beginPath();b.moveTo(0,k[0].y);for(l=0;l<k.length;l++)b.lineTo(k[l].x,k[l].y);b.lineWidth=a.strokeWidth*w;b.strokeStyle=a.strokeColour;b.stroke()}});r.register("multiline",{colours:["#666666","#803E75","#FF6800"],strokeColour:"#4d89f9",strokeWidth:1,delimiter:",",seriesDelimiter:"|",height:16,max:null,min:0,width:32},function(a){var c=this.values(),d=[].concat.apply([],c);console.log(d);var e=Math.max.apply(Math,d.concat([a.max])),d=Math.min.apply(Math,d.concat([a.min])),
f=this.prepareCanvas(a.width,a.height),b=this.context,g=f.width,f=f.height,s=g/(c[1].length-1),e=f/(e-d),k,l,h;b.lineWidth=a.strokeWidth*w;h=[{x:0,y:f-e*(0-d)},{x:g,y:f-e*(0-d)}];b.beginPath();b.moveTo(0,h[0].y);for(g=0;g<h.length;g++)b.lineTo(h[g].x,h[g].y);b.strokeStyle=a.colours[0%a.colours.length];b.stroke();for(k=0;k<c.length;k+=1){l=c[k];h=[];for(g=0;g<l.length;g++)h.push({x:g*s,y:f-e*(l[g]-d)});b.beginPath();b.moveTo(0,h[0].y);for(g=0;g<h.length;g++)b.lineTo(h[g].x,h[g].y);b.strokeStyle=a.colours[(k+
1)%a.colours.length];b.stroke()}});r.register("bar",{baselineHeight:1,baselineColour:"#000000",fontColour:"#000000",fontStyle:"12pt Arial, sans-serif",focusWidth:0,focusColour:"#000",colours:["#4D89F9"],delimiter:",",height:16,max:null,min:0,spacing:1,width:32},function(a){var c,d,e,f,b,g,s,k=this.values(),l=Math.max.apply(Math,k.concat([a.max])),h=Math.min.apply(Math,k.concat([a.min])),m=this.$el.data("position"),u=this.prepareCanvas(a.width,a.height),t=this.context,p=a.spacing;s=this.colours();
var q=a.focusWidth;c=u.width-2*p;var n=u.height-2*p;a.baselineHeight&&(n-=1);var r=n/(l-h),w=(c+p)/k.length;t.fillStyle=a.baselineColour;t.fillRect(0,r*l+p-a.baselineHeight/2,u.width,a.baselineHeight);for(c=0;c<k.length;c++){d=p+c*w;b=w-p;g=k[c];e=p+n-r*(g-h);if(0==g){if(0<=h||0<l)e-=1;f=1}else f=r*k[c];t.fillStyle=s.call(this,g,c,k);t.fillRect(d,e,b,f)}if(0<q&&m)for(m=JSON.parse(m),c=0;c<k.length;c++)if(d=p+c*w,b=w-p,m.x>=d&&m.x<=d+b){g=k[c];e=p+n-r*(g-h);if(0==g){if(0<=h||0<l)e-=1;f=1}else f=r*
k[c];s=e+(0>f?f:0);f=0>f?-f:f;m.y>=s&&m.y<=s+f&&(t.strokeStyle=a.focusColour,t.lineWidth=q,t.strokeRect(d-q/2,s-q/2,b+q,f+q),t.fillStyle=a.fontColour,t.font=a.fontStyle,m.x>u.width/2&&(t.textAlign="right"),m.y<u.height/2&&(t.textBaseline="top",m.y+=20),t.fillText(g+"",m.x,m.y))}0<q&&(u.addEventListener("mousemove",v.hoverEvent,!1),u.addEventListener("mouseout",v.exitEvent,!1))})})(jQuery,document,window.devicePixelRatio||1);
